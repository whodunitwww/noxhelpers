return function(a,b,c,d,e,f)local g,h,i,j,k,l,m=a.RunService,a.Lighting,a.Players,a.ContextActionService,a.UserInputService,a.StarterGui,a.Workspace;local n=b.Player:AddRightGroupbox("Visuals","glasses")n:AddToggle("InfiniteCamera",{Text="Infinite Camera Max",Default=false})local o;d.InfiniteCamera:OnChanged(function()local p=c.player;if not p then return end;if d.InfiniteCamera.Value then o=o or p.CameraMaxZoomDistance;p.CameraMaxZoomDistance=1e10 else p.CameraMaxZoomDistance=o or 128;o=nil end end)n:AddToggle("NoFog",{Text="No Fog",Default=false})local q,r;local function s(t)if not r then return end;if t:IsA("BloomEffect")or t:IsA("SunRaysEffect")or t:IsA("DepthOfFieldEffect")or t:IsA("ColorCorrectionEffect")or t:IsA("BlurEffect")then if t.Enabled then t:SetAttribute("NFWasEnabled",true)t.Enabled=false end elseif t:IsA("Atmosphere")then if r.Atmo[t]==nil then r.Atmo[t]={D=t.Density,H=t.Haze,O=t.Offset,G=t.Glare}end;t.Density=0;t.Haze=0;t.Glare=0 end end;local function u()if r then return end;r={FogEnd=h.FogEnd,FogStart=h.FogStart,FogColor=h.FogColor,Atmo={}}h.FogEnd,h.FogStart=1e10,1e10;for v,w in ipairs(h:GetDescendants())do s(w)end;q=h.DescendantAdded:Connect(s)end;local function x()if not r then return end;if q then q:Disconnect()q=nil end;h.FogEnd,h.FogStart,h.FogColor=r.FogEnd,r.FogStart,r.FogColor;for v,w in ipairs(h:GetDescendants())do if w:GetAttribute("NFWasEnabled")then w:SetAttribute("NFWasEnabled",nil)if w.Enabled~=nil then w.Enabled=true end end end;for y,z in pairs(r.Atmo)do if y and y.Parent then y.Density,y.Haze,y.Offset,y.Glare=z.D,z.H,z.O,z.G end end;r=nil end;d.NoFog:OnChanged(function()if d.NoFog.Value then u()else x()end end)n:AddToggle("XRay",{Text="X-Ray",Default=false,Tooltip="See through structures"})local function A(B)for v,C in ipairs(m:GetDescendants())do if C:IsA("BasePart")then if not C.Parent:FindFirstChildOfClass("Humanoid")and not(C.Parent.Parent and C.Parent.Parent:FindFirstChildOfClass("Humanoid"))then C.LocalTransparencyModifier=B and 0.5 or 0 end end end end;d.XRay:OnChanged(function()A(d.XRay.Value)end)n:AddToggle("Fullbright",{Text="Fullbright",Default=false})n:AddSlider("Fullbright_Brightness",{Text="Brightness",Default=2,Min=1,Max=10,Rounding=1})local D,E;local function F()if D then return end;E=E or{B=h.Brightness,GS=h.GlobalShadows,A=h.Ambient}D=g.RenderStepped:Connect(function()h.Brightness=e.Fullbright_Brightness.Value;h.GlobalShadows=false;h.Ambient=Color3.new(1,1,1)end)end;local function G()if D then D:Disconnect()D=nil end;if E then h.Brightness=E.B;h.GlobalShadows=E.GS;h.Ambient=E.A;E=nil end end;d.Fullbright:OnChanged(function()if d.Fullbright.Value then F()else G()end end)n:AddSlider("CameraFOV",{Text="Camera FOV",Default=70,Min=40,Max=120,Rounding=0})local function H()if c.camera then c.camera.FieldOfView=e.CameraFOV.Value end end;e.CameraFOV:OnChanged(H)H()n:AddToggle("FreecamEnabled",{Text="Freecam",Default=false}):AddKeyPicker("FreecamKey",{Default="P",SyncToggleState=true,Mode="Toggle",Text="Freecam Key"})n:AddSlider("FreecamSensitivity",{Text="Freecam Sensitivity",Default=1.0,Min=0.1,Max=3.0,Rounding=2,Tooltip="Scales look + movement speed"})local I=m.CurrentCamera;m:GetPropertyChangedSignal("CurrentCamera"):Connect(function()I=m.CurrentCamera end)local J,K,L,M,N,O,P,Q=math.pi,math.exp,math.rad,math.sqrt,math.tan,math.abs,math.clamp,math.sign;local R=L(90)local S={}S.__index=S;function S.new(T,U)return setmetatable({f=T,p=U,v=U*0},S)end;function S:Update(V,W)local X=self.f*2*J;local Y,Z=self.p,self.v;local _=W-Y;local a0=K(-X*V)local a1=W+(Z*V-_*(X*V+1))*a0;local a2=(X*V*(_*X-Z)+Z)*a0;self.p,self.v=a1,a2;return a1 end;function S:Reset(U)self.p=U;self.v=U*0 end;local a3=S.new(1.5,Vector3.new())local a4=S.new(1.0,Vector2.new())local a5=S.new(4.0,0)local a6,a7,a8=Vector3.new(),Vector2.new(),70;local a9=1;local aa={KB="CerbFC_Keyboard",MousePan="CerbFC_MousePan",Wheel="CerbFC_MouseWheel",GPBtn="CerbFC_GPBtn",GPTrig="CerbFC_GPTrig",GPThumb="CerbFC_GPThumb"}local ab={ButtonX=0,ButtonY=0,ButtonL2=0,ButtonR2=0,Thumbstick1=Vector2.new(),Thumbstick2=Vector2.new()}local ac={W=0,A=0,S=0,D=0,E=0,Q=0,U=0,H=0,J=0,K=0,I=0,Y=0,Up=0,Down=0}local ad={Delta=Vector2.new(),MouseWheel=0}local function ae(af)local ag,ah=2.0,0.15;local function ai(C)return(K(ag*C)-1)/(K(ag)-1)end;local function aj(C)return ai((C-ah)/(1-ah))end;return Q(af)*P(aj(O(af)),0,1)end;local function ak()j:BindActionAtPriority(aa.KB,function(v,al,am)ac[am.KeyCode.Name]=al==Enum.UserInputState.Begin and 1 or 0;return Enum.ContextActionResult.Sink end,false,Enum.ContextActionPriority.High.Value,Enum.KeyCode.W,Enum.KeyCode.U,Enum.KeyCode.A,Enum.KeyCode.H,Enum.KeyCode.S,Enum.KeyCode.J,Enum.KeyCode.D,Enum.KeyCode.K,Enum.KeyCode.E,Enum.KeyCode.I,Enum.KeyCode.Q,Enum.KeyCode.Y,Enum.KeyCode.Up,Enum.KeyCode.Down)j:BindActionAtPriority(aa.MousePan,function(v,v,am)local w=am.Delta;ad.Delta=Vector2.new(-w.y,-w.x)return Enum.ContextActionResult.Sink end,false,Enum.ContextActionPriority.High.Value,Enum.UserInputType.MouseMovement)j:BindActionAtPriority(aa.Wheel,function(v,v,am)ad[am.UserInputType.Name]=-am.Position.z;return Enum.ContextActionResult.Sink end,false,Enum.ContextActionPriority.High.Value,Enum.UserInputType.MouseWheel)j:BindActionAtPriority(aa.GPBtn,function(v,al,am)ab[am.KeyCode.Name]=al==Enum.UserInputState.Begin and 1 or 0;return Enum.ContextActionResult.Sink end,false,Enum.ContextActionPriority.High.Value,Enum.KeyCode.ButtonX,Enum.KeyCode.ButtonY)j:BindActionAtPriority(aa.GPTrig,function(v,v,am)ab[am.KeyCode.Name]=am.Position.z;return Enum.ContextActionResult.Sink end,false,Enum.ContextActionPriority.High.Value,Enum.KeyCode.ButtonR2,Enum.KeyCode.ButtonL2)j:BindActionAtPriority(aa.GPThumb,function(v,v,am)ab[am.KeyCode.Name]=am.Position;return Enum.ContextActionResult.Sink end,false,Enum.ContextActionPriority.High.Value,Enum.KeyCode.Thumbstick1,Enum.KeyCode.Thumbstick2)end;local function an()a9=1;for ao in pairs(ab)do ab[ao]=typeof(ab[ao])=="Vector2"and Vector2.new()or 0 end;for ao in pairs(ac)do ac[ao]=0 end;ad.Delta=Vector2.new()ad.MouseWheel=0;for v,ap in pairs(aa)do j:UnbindAction(ap)end end;local aq={}local function ar()aq.core={Backpack=l:GetCoreGuiEnabled(Enum.CoreGuiType.Backpack),Chat=l:GetCoreGuiEnabled(Enum.CoreGuiType.Chat),Health=l:GetCoreGuiEnabled(Enum.CoreGuiType.Health),PlayerList=l:GetCoreGuiEnabled(Enum.CoreGuiType.PlayerList)}for ao,C in pairs(aq.core)do l:SetCoreGuiEnabled(Enum.CoreGuiType[ao],false)end;local as=i.LocalPlayer:FindFirstChildOfClass("PlayerGui")aq.screens={}if as then for v,at in ipairs(as:GetChildren())do if at:IsA("ScreenGui")and at.Enabled then aq.screens[#aq.screens+1]=at;at.Enabled=false end end end end;local function au()if aq.core then for ao,C in pairs(aq.core)do l:SetCoreGuiEnabled(Enum.CoreGuiType[ao],C)end end;if aq.screens then for v,at in ipairs(aq.screens)do if at.Parent then at.Enabled=true end end end;aq={}end;local av,aw,ax;local function ay()av=c.humanoid;if av and av.SetStateEnabled then aw=av:GetStateEnabled(Enum.HumanoidStateType.Jumping)av:SetStateEnabled(Enum.HumanoidStateType.Jumping,false)end;if k and k.JumpRequest then ax=k.JumpRequest:Connect(function()if av then av.Jump=false end end)end end;local function az()if ax then ax:Disconnect()ax=nil end;if av and av.SetStateEnabled then av:SetStateEnabled(Enum.HumanoidStateType.Jumping,aw~=false)end;av=nil;aw=nil end;local function aA(V,aB)a9=P(a9+V*(ac.Up-ac.Down)*0.75,0.01,4)local aC=Vector3.new(ae(ab.Thumbstick1.X),ae(ab.ButtonR2)-ae(ab.ButtonL2),ae(-ab.Thumbstick1.Y))local ao=Vector3.new(ac.D-ac.A+ac.K-ac.H,ac.E-ac.Q+ac.I-ac.Y,ac.S-ac.W+ac.J-ac.U)local aD=k:IsKeyDown(Enum.KeyCode.LeftShift)or k:IsKeyDown(Enum.KeyCode.RightShift)return(aC+ao)*64*a9*(aD and 0.25 or 1)*aB end;local function aE(V,aB)local aF=Vector2.new(ae(ab.Thumbstick2.Y),ae(-ab.Thumbstick2.X))*J/8;local aG=ad.Delta*J/64;ad.Delta=Vector2.new()return(aF+aG)*8*aB end;local function aH()local aF=(ab.ButtonX-ab.ButtonY)*0.25;local aI=ad.MouseWheel*1.0;ad.MouseWheel=0;return aF+aI end;local aJ=false;local function aK(V)local aB=e.FreecamSensitivity.Value or 1;local aL=a3:Update(V,aA(V,aB))local aM=a4:Update(V,aE(V,aB))local aN=a5:Update(V,aH())local aO=M(N(L(70/2))/N(L(a8/2)))a8=P(a8+aN*300*V/aO,1,120)a7=a7+aM*V/aO;a7=Vector2.new(P(a7.X,-R,R),a7.Y%(2*J))local aP=CFrame.new(a6)*CFrame.fromOrientation(a7.X,a7.Y,0)*CFrame.new(aL*V)a6=aP.Position;I.CFrame=aP;I.Focus=aP;I.FieldOfView=a8 end;local function aQ()if aJ then return end;local aP=I.CFrame;a7=Vector2.new(aP:toEulerAnglesYXZ())a6=aP.Position;a8=I.FieldOfView;a3:Reset(Vector3.new())a4:Reset(Vector2.new())a5:Reset(0)ar()ay()I.CameraType=Enum.CameraType.Scriptable;k.MouseIconEnabled=false;k.MouseBehavior=Enum.MouseBehavior.LockCenter;ak()g:BindToRenderStep("CerbFreecam",Enum.RenderPriority.Camera.Value,aK)aJ=true end;local function aR()if not aJ then return end;g:UnbindFromRenderStep("CerbFreecam")an()az()I.CameraType=Enum.CameraType.Custom;k.MouseBehavior=Enum.MouseBehavior.Default;k.MouseIconEnabled=true;ad.Delta=Vector2.new()ad.MouseWheel=0;au()aJ=false end;d.FreecamEnabled:OnChanged(function()if d.FreecamEnabled.Value then aQ()else aR()end end)f:OnUnload(function()if d.InfiniteCamera and d.InfiniteCamera.Value then d.InfiniteCamera:SetValue(false)end;if d.NoFog and d.NoFog.Value then d.NoFog:SetValue(false)end;if d.XRay and d.XRay.Value then d.XRay:SetValue(false)end;if d.Fullbright and d.Fullbright.Value then d.Fullbright:SetValue(false)end;if d.FreecamEnabled and d.FreecamEnabled.Value then d.FreecamEnabled:SetValue(false)end;G()x()A(false)if aJ then aR()end end)end
