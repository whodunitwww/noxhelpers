return function(a,b,c,d,e,f)local g,h,i,j,k,l,m=a.RunService,a.Lighting,a.Players,a.ContextActionService,a.UserInputService,a.StarterGui,a.Workspace;local n=b.Player:AddRightGroupbox("Visuals","glasses")n:AddToggle("InfiniteCamera",{Text="Infinite Camera Max",Default=false})local o;d.InfiniteCamera:OnChanged(function()local p=c.player;if not p then return end;if d.InfiniteCamera.Value then o=o or p.CameraMaxZoomDistance;p.CameraMaxZoomDistance=1e10 else p.CameraMaxZoomDistance=o or 128;o=nil end end)n:AddToggle("NoFog",{Text="No Fog",Default=false})local q,r;local function s(t)if not r then return end;if t:IsA("BloomEffect")or t:IsA("SunRaysEffect")or t:IsA("DepthOfFieldEffect")or t:IsA("ColorCorrectionEffect")or t:IsA("BlurEffect")then if t.Enabled then t:SetAttribute("NFWasEnabled",true)t.Enabled=false end elseif t:IsA("Atmosphere")then if r.Atmo[t]==nil then r.Atmo[t]={D=t.Density,H=t.Haze,O=t.Offset,G=t.Glare}end;t.Density=0;t.Haze=0;t.Glare=0 end end;local function u()if r then return end;r={FogEnd=h.FogEnd,FogStart=h.FogStart,FogColor=h.FogColor,Atmo={}}h.FogEnd,h.FogStart=1e10,1e10;for v,w in ipairs(h:GetDescendants())do s(w)end;q=h.DescendantAdded:Connect(s)end;local function x()if not r then return end;if q then q:Disconnect()q=nil end;h.FogEnd,h.FogStart,h.FogColor=r.FogEnd,r.FogStart,r.FogColor;for v,w in ipairs(h:GetDescendants())do if w:GetAttribute("NFWasEnabled")then w:SetAttribute("NFWasEnabled",nil)if w.Enabled~=nil then w.Enabled=true end end end;for y,z in pairs(r.Atmo)do if y and y.Parent then y.Density,y.Haze,y.Offset,y.Glare=z.D,z.H,z.O,z.G end end;r=nil end;d.NoFog:OnChanged(function()if d.NoFog.Value then u()else x()end end)n:AddToggle("XRay",{Text="X-Ray",Default=false,Tooltip="See through structures"})local function A(B)for v,C in ipairs(m:GetDescendants())do if C:IsA("BasePart")then if not C.Parent:FindFirstChildOfClass("Humanoid")and not(C.Parent.Parent and C.Parent.Parent:FindFirstChildOfClass("Humanoid"))then C.LocalTransparencyModifier=B and 0.5 or 0 end end end end;d.XRay:OnChanged(function()A(d.XRay.Value)end)n:AddToggle("Fullbright",{Text="Fullbright",Default=false})n:AddSlider("Fullbright_Brightness",{Text="Brightness",Default=2,Min=1,Max=10,Rounding=1})local D,E;local function F()if D then return end;E=E or{B=h.Brightness,GS=h.GlobalShadows,A=h.Ambient}D=g.RenderStepped:Connect(function()h.Brightness=e.Fullbright_Brightness.Value;h.GlobalShadows=false;h.Ambient=Color3.new(1,1,1)end)end;local function G()if D then D:Disconnect()D=nil end;if E then h.Brightness=E.B;h.GlobalShadows=E.GS;h.Ambient=E.A;E=nil end end;d.Fullbright:OnChanged(function()if d.Fullbright.Value then F()else G()end end)n:AddSlider("CameraFOV",{Text="Camera FOV",Default=70,Min=40,Max=120,Rounding=0})local function H()if c.camera then c.camera.FieldOfView=e.CameraFOV.Value end end;e.CameraFOV:OnChanged(H)H()n:AddToggle("FreecamEnabled",{Text="Freecam",Default=false}):AddKeyPicker("FreecamKey",{Default="P",SyncToggleState=true,Mode="Toggle",Text="Freecam Key"})n:AddSlider("FreecamSensitivity",{Text="Freecam Sensitivity",Default=1.0,Min=0.1,Max=3.0,Rounding=2,Tooltip="Scales look + movement speed"})local I=m.CurrentCamera;m:GetPropertyChangedSignal("CurrentCamera"):Connect(function()I=m.CurrentCamera end)local J,K,L,M,N,O,P,Q=math.pi,math.exp,math.rad,math.sqrt,math.tan,math.abs,math.clamp,math.sign;local R=L(90)local S={}S.__index=S;function S.new(T,U)return setmetatable({f=T,p=U,v=U*0},S)end;function S:Update(V,W)local X=self.f*2*J;local Y,Z=self.p,self.v;local _=W-Y;local a0=K(-X*V)local a1=W+(Z*V-_*(X*V+1))*a0;local a2=(X*V*(_*X-Z)+Z)*a0;self.p,self.v=a1,a2;return a1 end;function S:Reset(U)self.p=U;self.v=U*0 end;local a3=S.new(1.5,Vector3.new())local a4=S.new(1.0,Vector2.new())local a5=S.new(4.0,0)local a6,a7,a8=Vector3.new(),Vector2.new(),70;local a9=1;local aa={KB="CerbFC_Keyboard",MousePan="CerbFC_MousePan",Wheel="CerbFC_MouseWheel",GPBtn="CerbFC_GPBtn",GPTrig="CerbFC_GPTrig",GPThumb="CerbFC_GPThumb"}local ab={ButtonX=0,ButtonY=0,ButtonL2=0,ButtonR2=0,Thumbstick1=Vector2.new(),Thumbstick2=Vector2.new()}local ac={W=0,A=0,S=0,D=0,E=0,Q=0,U=0,H=0,J=0,K=0,I=0,Y=0,Up=0,Down=0}local ad={Delta=Vector2.new(),MouseWheel=0}local ae={}local af={}local ag=nil;local ah=Vector2.new()local function ai()local aj={}for v,U in pairs(af)do aj[#aj+1]=U end;return aj end;local function ak()local al=ai()if#al==1 then local am,an=next(af)ag=nil;ah=Vector2.new()elseif#al>=2 then local a1,ao=al[1],al[2]local ap=(a1+ao)*0.5;local aq=ap;local ar=(a1-ao).Magnitude;if ag then local as=ar-ag;ad.MouseWheel=ad.MouseWheel+as*0.01 end;ag=ar else ag=nil;ah=Vector2.new()end end;local function at(au)local av,aw=2.0,0.15;local function ax(C)return(K(av*C)-1)/(K(av)-1)end;local function ay(C)return ax((C-aw)/(1-aw))end;return Q(au)*P(ay(O(au)),0,1)end;local function az()j:BindActionAtPriority(aa.KB,function(v,aA,aB)ac[aB.KeyCode.Name]=aA==Enum.UserInputState.Begin and 1 or 0;return Enum.ContextActionResult.Sink end,false,Enum.ContextActionPriority.High.Value,Enum.KeyCode.W,Enum.KeyCode.U,Enum.KeyCode.A,Enum.KeyCode.H,Enum.KeyCode.S,Enum.KeyCode.J,Enum.KeyCode.D,Enum.KeyCode.K,Enum.KeyCode.E,Enum.KeyCode.I,Enum.KeyCode.Q,Enum.KeyCode.Y,Enum.KeyCode.Up,Enum.KeyCode.Down)j:BindActionAtPriority(aa.MousePan,function(v,v,aB)local w=aB.Delta;ad.Delta=Vector2.new(-w.y,-w.x)return Enum.ContextActionResult.Sink end,false,Enum.ContextActionPriority.High.Value,Enum.UserInputType.MouseMovement)j:BindActionAtPriority(aa.Wheel,function(v,v,aB)ad[aB.UserInputType.Name]=-aB.Position.z;return Enum.ContextActionResult.Sink end,false,Enum.ContextActionPriority.High.Value,Enum.UserInputType.MouseWheel)j:BindActionAtPriority(aa.GPBtn,function(v,aA,aB)ab[aB.KeyCode.Name]=aA==Enum.UserInputState.Begin and 1 or 0;return Enum.ContextActionResult.Sink end,false,Enum.ContextActionPriority.High.Value,Enum.KeyCode.ButtonX,Enum.KeyCode.ButtonY)j:BindActionAtPriority(aa.GPTrig,function(v,v,aB)ab[aB.KeyCode.Name]=aB.Position.z;return Enum.ContextActionResult.Sink end,false,Enum.ContextActionPriority.High.Value,Enum.KeyCode.ButtonR2,Enum.KeyCode.ButtonL2)j:BindActionAtPriority(aa.GPThumb,function(v,v,aB)ab[aB.KeyCode.Name]=aB.Position;return Enum.ContextActionResult.Sink end,false,Enum.ContextActionPriority.High.Value,Enum.KeyCode.Thumbstick1,Enum.KeyCode.Thumbstick2)if k.TouchEnabled then ae.Started=k.TouchStarted:Connect(function(aB,aC)af[aB.PointerId]=Vector2.new(aB.Position.X,aB.Position.Y)ak()end)ae.Changed=k.TouchChanged:Connect(function(aB,aC)local am=aB.PointerId;local aD=af[am]local aE=Vector2.new(aB.Position.X,aB.Position.Y)af[am]=aE;local al=ai()if#al==1 and aD then local w=aE-aD;ad.Delta=ad.Delta+Vector2.new(-w.Y,-w.X)*0.5 elseif#al>=2 then local aF=al[1]local aG=al[2]local aH=(aF+aG)*0.5;local aI;if aD then local aJ,aK;for aL,U in pairs(af)do if aL~=am then aJ=aL;aK=U;break end end;if aK then aI=(aD+aK)*0.5 end end;if aI then local aM=aH-aI;ah=ah+Vector2.new(aM.X,-aM.Y)*0.01;if ah.Magnitude>1 then ah=ah.Unit end end end;ak()end)ae.Ended=k.TouchEnded:Connect(function(aB,aC)af[aB.PointerId]=nil;if next(af)==nil then ag=nil;ah=Vector2.new()end;ak()end)end end;local function aN()a9=1;for aO in pairs(ab)do ab[aO]=typeof(ab[aO])=="Vector2"and Vector2.new()or 0 end;for aO in pairs(ac)do ac[aO]=0 end;ad.Delta=Vector2.new()ad.MouseWheel=0;for v,aP in pairs(aa)do j:UnbindAction(aP)end;if ae.Started then ae.Started:Disconnect()end;if ae.Changed then ae.Changed:Disconnect()end;if ae.Ended then ae.Ended:Disconnect()end;ae={}af={}ag=nil;ah=Vector2.new()end;local aQ={}local function aR()aQ.core={Backpack=l:GetCoreGuiEnabled(Enum.CoreGuiType.Backpack),Chat=l:GetCoreGuiEnabled(Enum.CoreGuiType.Chat),Health=l:GetCoreGuiEnabled(Enum.CoreGuiType.Health),PlayerList=l:GetCoreGuiEnabled(Enum.CoreGuiType.PlayerList)}for aO,C in pairs(aQ.core)do l:SetCoreGuiEnabled(Enum.CoreGuiType[aO],false)end;local aS=i.LocalPlayer:FindFirstChildOfClass("PlayerGui")aQ.screens={}if aS then for v,aT in ipairs(aS:GetChildren())do if aT:IsA("ScreenGui")and aT.Enabled then aQ.screens[#aQ.screens+1]=aT;aT.Enabled=false end end end end;local function aU()if aQ.core then for aO,C in pairs(aQ.core)do l:SetCoreGuiEnabled(Enum.CoreGuiType[aO],C)end end;if aQ.screens then for v,aT in ipairs(aQ.screens)do if aT.Parent then aT.Enabled=true end end end;aQ={}end;local aV,aW,aX;local function aY()aV=c.humanoid;if aV and aV.SetStateEnabled then aW=aV:GetStateEnabled(Enum.HumanoidStateType.Jumping)aV:SetStateEnabled(Enum.HumanoidStateType.Jumping,false)end;if k and k.JumpRequest then aX=k.JumpRequest:Connect(function()if aV then aV.Jump=false end end)end end;local function aZ()if aX then aX:Disconnect()aX=nil end;if aV and aV.SetStateEnabled then aV:SetStateEnabled(Enum.HumanoidStateType.Jumping,aW~=false)end;aV=nil;aW=nil end;local function a_(V,b0)a9=P(a9+V*(ac.Up-ac.Down)*0.75,0.01,4)local b1=Vector3.new(at(ab.Thumbstick1.X),at(ab.ButtonR2)-at(ab.ButtonL2),at(-ab.Thumbstick1.Y))local aO=Vector3.new(ac.D-ac.A+ac.K-ac.H,ac.E-ac.Q+ac.I-ac.Y,ac.S-ac.W+ac.J-ac.U)local b2=Vector3.new(ah.X,0,ah.Y)local b3=k:IsKeyDown(Enum.KeyCode.LeftShift)or k:IsKeyDown(Enum.KeyCode.RightShift)return(b1+aO+b2)*64*a9*(b3 and 0.25 or 1)*b0 end;local function b4(V,b0)local b5=Vector2.new(at(ab.Thumbstick2.Y),at(-ab.Thumbstick2.X))*J/8;local b6=ad.Delta*J/64;ad.Delta=Vector2.new()return(b5+b6)*8*b0 end;local function b7()local b5=(ab.ButtonX-ab.ButtonY)*0.25;local b8=ad.MouseWheel*1.0;ad.MouseWheel=0;return b5+b8 end;local b9=false;local function ba(V)local b0=e.FreecamSensitivity.Value or 1;local bb=a3:Update(V,a_(V,b0))local bc=a4:Update(V,b4(V,b0))local bd=a5:Update(V,b7())local be=M(N(L(70/2))/N(L(a8/2)))a8=P(a8+bd*300*V/be,1,120)a7=a7+bc*V/be;a7=Vector2.new(P(a7.X,-R,R),a7.Y%(2*J))local bf=CFrame.new(a6)*CFrame.fromOrientation(a7.X,a7.Y,0)*CFrame.new(bb*V)a6=bf.Position;I.CFrame=bf;I.Focus=bf;I.FieldOfView=a8 end;local function bg()if b9 then return end;local bf=I.CFrame;a7=Vector2.new(bf:toEulerAnglesYXZ())a6=bf.Position;a8=I.FieldOfView;a3:Reset(Vector3.new())a4:Reset(Vector2.new())a5:Reset(0)aR()aY()I.CameraType=Enum.CameraType.Scriptable;k.MouseIconEnabled=false;k.MouseBehavior=Enum.MouseBehavior.LockCenter;az()g:BindToRenderStep("CerbFreecam",Enum.RenderPriority.Camera.Value,ba)b9=true end;local function bh()if not b9 then return end;g:UnbindFromRenderStep("CerbFreecam")aN()aZ()I.CameraType=Enum.CameraType.Custom;k.MouseBehavior=Enum.MouseBehavior.Default;k.MouseIconEnabled=true;ad.Delta=Vector2.new()ad.MouseWheel=0;aU()b9=false end;d.FreecamEnabled:OnChanged(function()if d.FreecamEnabled.Value then bg()else bh()end end)f:OnUnload(function()if d.InfiniteCamera and d.InfiniteCamera.Value then d.InfiniteCamera:SetValue(false)end;if d.NoFog and d.NoFog.Value then d.NoFog:SetValue(false)end;if d.XRay and d.XRay.Value then d.XRay:SetValue(false)end;if d.Fullbright and d.Fullbright.Value then d.Fullbright:SetValue(false)end;if d.FreecamEnabled and d.FreecamEnabled.Value then d.FreecamEnabled:SetValue(false)end;G()x()A(false)if b9 then bh()end end)end
