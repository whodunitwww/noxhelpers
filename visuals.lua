return function(a,b,c,d,e,f)local g,h,i,j,k,l,m=a.RunService,a.Lighting,a.Players,a.ContextActionService,a.UserInputService,a.StarterGui,a.Workspace;local n=b.Player:AddRightGroupbox("Visuals","glasses")n:AddToggle("InfiniteCamera",{Text="Infinite Camera Max",Default=false})local o;d.InfiniteCamera:OnChanged(function()local p=c.player;if not p then return end;if d.InfiniteCamera.Value then o=o or p.CameraMaxZoomDistance;p.CameraMaxZoomDistance=1e10 else p.CameraMaxZoomDistance=o or 128;o=nil end end)n:AddToggle("NoFog",{Text="No Fog",Default=false})local q,r;local function s(t)if not r then return end;if t:IsA("BloomEffect")or t:IsA("SunRaysEffect")or t:IsA("DepthOfFieldEffect")or t:IsA("ColorCorrectionEffect")or t:IsA("BlurEffect")then if t.Enabled then t:SetAttribute("NFWasEnabled",true)t.Enabled=false end elseif t:IsA("Atmosphere")then if r.Atmo[t]==nil then r.Atmo[t]={D=t.Density,H=t.Haze,O=t.Offset,G=t.Glare}end;t.Density=0;t.Haze=0;t.Glare=0 end end;local function u()if r then return end;r={FogEnd=h.FogEnd,FogStart=h.FogStart,FogColor=h.FogColor,Atmo={}}h.FogEnd,h.FogStart=1e10,1e10;for v,w in ipairs(h:GetDescendants())do s(w)end;q=h.DescendantAdded:Connect(s)end;local function x()if not r then return end;if q then q:Disconnect()q=nil end;h.FogEnd,h.FogStart,h.FogColor=r.FogEnd,r.FogStart,r.FogColor;for v,w in ipairs(h:GetDescendants())do if w:GetAttribute("NFWasEnabled")then w:SetAttribute("NFWasEnabled",nil)if w.Enabled~=nil then w.Enabled=true end end end;for y,z in pairs(r.Atmo)do if y and y.Parent then y.Density,y.Haze,y.Offset,y.Glare=z.D,z.H,z.O,z.G end end;r=nil end;d.NoFog:OnChanged(function()if d.NoFog.Value then u()else x()end end)n:AddToggle("XRay",{Text="X-Ray",Default=false,Tooltip="See through structures"})local function A(B)for v,C in ipairs(m:GetDescendants())do if C:IsA("BasePart")then if not C.Parent:FindFirstChildOfClass("Humanoid")and not(C.Parent.Parent and C.Parent.Parent:FindFirstChildOfClass("Humanoid"))then C.LocalTransparencyModifier=B and 0.5 or 0 end end end end;d.XRay:OnChanged(function()A(d.XRay.Value)end)n:AddToggle("Fullbright",{Text="Fullbright",Default=false})n:AddSlider("Fullbright_Brightness",{Text="Brightness",Default=2,Min=1,Max=10,Rounding=1})local D,E;local function F()if D then return end;E=E or{B=h.Brightness,GS=h.GlobalShadows,A=h.Ambient}D=g.RenderStepped:Connect(function()h.Brightness=e.Fullbright_Brightness.Value;h.GlobalShadows=false;h.Ambient=Color3.new(1,1,1)end)end;local function G()if D then D:Disconnect()D=nil end;if E then h.Brightness=E.B;h.GlobalShadows=E.GS;h.Ambient=E.A;E=nil end end;d.Fullbright:OnChanged(function()if d.Fullbright.Value then F()else G()end end)n:AddSlider("CameraFOV",{Text="Camera FOV",Default=70,Min=40,Max=120,Rounding=0})local function H()if c.camera then c.camera.FieldOfView=e.CameraFOV.Value end end;e.CameraFOV:OnChanged(H)H()n:AddToggle("FreecamEnabled",{Text="Freecam",Default=false}):AddKeyPicker("FreecamKey",{Default="P",SyncToggleState=true,Mode="Toggle",Text="Freecam Key"})n:AddSlider("FreecamSensitivity",{Text="Freecam Sensitivity",Default=1.0,Min=0.1,Max=3.0,Rounding=2,Tooltip="Scales look + movement speed"})local I=m.CurrentCamera;m:GetPropertyChangedSignal("CurrentCamera"):Connect(function()I=m.CurrentCamera end)local J,K,L,M,N,O,P,Q=math.pi,math.exp,math.rad,math.sqrt,math.tan,math.abs,math.clamp,math.sign;local R=L(90)local S={}S.__index=S;function S.new(T,U)return setmetatable({f=T,p=U,v=U*0},S)end;function S:Update(V,W)local X=self.f*2*J;local Y,Z=self.p,self.v;local _=W-Y;local a0=K(-X*V)local a1=W+(Z*V-_*(X*V+1))*a0;local a2=(X*V*(_*X-Z)+Z)*a0;self.p,self.v=a1,a2;return a1 end;function S:Reset(U)self.p=U;self.v=U*0 end;local a3=S.new(1.5,Vector3.new())local a4=S.new(1.0,Vector2.new())local a5=S.new(4.0,0)local a6,a7,a8=Vector3.new(),Vector2.new(),70;local a9=1;local aa={KB="CerbFC_Keyboard",MousePan="CerbFC_MousePan",Wheel="CerbFC_MouseWheel",GPBtn="CerbFC_GPBtn",GPTrig="CerbFC_GPTrig",GPThumb="CerbFC_GPThumb",TouchPan="CerbFC_TouchPan",Pinch="CerbFC_Pinch"}local ab={ButtonX=0,ButtonY=0,ButtonL2=0,ButtonR2=0,Thumbstick1=Vector2.new(),Thumbstick2=Vector2.new()}local ac={W=0,A=0,S=0,D=0,E=0,Q=0,U=0,H=0,J=0,K=0,I=0,Y=0,Up=0,Down=0}local ad={Delta=Vector2.new(),MouseWheel=0}local ae={PanDelta=Vector2.new(),VerticalPanDelta=Vector2.new(),PinchDelta=1.0,ActiveTouches={}}local function af(ag)local ah,ai=2.0,0.15;local function aj(C)return(K(ah*C)-1)/(K(ah)-1)end;local function ak(C)return aj((C-ai)/(1-ai))end;return Q(ag)*P(ak(O(ag)),0,1)end;local function al()j:BindActionAtPriority(aa.KB,function(v,am,an)ac[an.KeyCode.Name]=am==Enum.UserInputState.Begin and 1 or 0;return Enum.ContextActionResult.Sink end,false,Enum.ContextActionPriority.High.Value,Enum.KeyCode.W,Enum.KeyCode.U,Enum.KeyCode.A,Enum.KeyCode.H,Enum.KeyCode.S,Enum.KeyCode.J,Enum.KeyCode.D,Enum.KeyCode.K,Enum.KeyCode.E,Enum.KeyCode.I,Enum.KeyCode.Q,Enum.KeyCode.Y,Enum.KeyCode.Up,Enum.KeyCode.Down)j:BindActionAtPriority(aa.MousePan,function(v,v,an)local w=an.Delta;ad.Delta=Vector2.new(-w.y,-w.x)return Enum.ContextActionResult.Sink end,false,Enum.ContextActionPriority.High.Value,Enum.UserInputType.MouseMovement)j:BindActionAtPriority(aa.Wheel,function(v,v,an)ad[an.UserInputType.Name]=-an.Position.z;return Enum.ContextActionResult.Sink end,false,Enum.ContextActionPriority.High.Value,Enum.UserInputType.MouseWheel)j:BindActionAtPriority(aa.TouchPan,function(v,am,an)if am==Enum.UserInputState.Begin then ae.ActiveTouches[an.UserInputType]=true elseif am==Enum.UserInputState.End then ae.ActiveTouches[an.UserInputType]=nil elseif am==Enum.UserInputState.Change then local ao=0;for v in pairs(ae.ActiveTouches)do ao=ao+1 end;if ao==1 then local w=an.Delta;ae.PanDelta=ae.PanDelta+Vector2.new(-w.y,-w.x)elseif ao>=2 then local w=an.Delta;ae.VerticalPanDelta=ae.VerticalPanDelta+w end end;return Enum.ContextActionResult.Sink end,false,Enum.ContextActionPriority.High.Value,Enum.UserInputType.Touch)j:BindActionAtPriority(aa.Pinch,function(v,am,an)if am==Enum.UserInputState.Change then ae.PinchDelta=an.Scale end;return Enum.ContextActionResult.Sink end,false,Enum.ContextActionPriority.High.Value,Enum.UserInputType.Pinch)j:BindActionAtPriority(aa.GPBtn,function(v,am,an)ab[an.KeyCode.Name]=am==Enum.UserInputState.Begin and 1 or 0;return Enum.ContextActionResult.Sink end,false,Enum.ContextActionPriority.High.Value,Enum.KeyCode.ButtonX,Enum.KeyCode.ButtonY)j:BindActionAtPriority(aa.GPTrig,function(v,v,an)ab[an.KeyCode.Name]=an.Position.z;return Enum.ContextActionResult.Sink end,false,Enum.ContextActionPriority.High.Value,Enum.KeyCode.ButtonR2,Enum.KeyCode.ButtonL2)j:BindActionAtPriority(aa.GPThumb,function(v,v,an)ab[an.KeyCode.Name]=an.Position;return Enum.ContextActionResult.Sink end,false,Enum.ContextActionPriority.High.Value,Enum.KeyCode.Thumbstick1,Enum.KeyCode.Thumbstick2)end;local function ap()a9=1;for aq in pairs(ab)do ab[aq]=typeof(ab[aq])=="Vector2"and Vector2.new()or 0 end;for aq in pairs(ac)do ac[aq]=0 end;ad.Delta=Vector2.new()ad.MouseWheel=0;ae.PanDelta=Vector2.new()ae.VerticalPanDelta=Vector2.new()ae.PinchDelta=1.0;table.clear(ae.ActiveTouches)for v,ar in pairs(aa)do j:UnbindAction(ar)end end;local as={}local function at()local au=i.LocalPlayer:FindFirstChildOfClass("PlayerGui")as.screens={}if au then for v,av in ipairs(au:GetChildren())do if av:IsA("ScreenGui")and av.Enabled and av.Name~="TouchGui"and av.Name~="DynamicThumbstick"then as.screens[#as.screens+1]=av;av.Enabled=false end end end end;local function aw()if as.screens then for v,av in ipairs(as.screens)do if av.Parent then av.Enabled=true end end end;as={}end;local ax,ay,az;local function aA()ax=c.humanoid;if ax and ax.SetStateEnabled then ay=ax:GetStateEnabled(Enum.HumanoidStateType.Jumping)ax:SetStateEnabled(Enum.HumanoidStateType.Jumping,false)end;if k and k.JumpRequest then az=k.JumpRequest:Connect(function()if ax then ax.Jump=false end end)end end;local function aB()if az then az:Disconnect()az=nil end;if ax and ax.SetStateEnabled then ax:SetStateEnabled(Enum.HumanoidStateType.Jumping,ay~=false)end;ax=nil;ay=nil end;local function aC(V,aD)a9=P(a9+V*(ac.Up-ac.Down)*0.75,0.01,4)local aE=Vector3.new(af(ab.Thumbstick1.X),af(ab.ButtonR2)-af(ab.ButtonL2),af(-ab.Thumbstick1.Y))local aq=Vector3.new(ac.D-ac.A+ac.K-ac.H,ac.E-ac.Q+ac.I-ac.Y-ae.VerticalPanDelta.Y*0.1,ac.S-ac.W+ac.J-ac.U)ae.VerticalPanDelta=Vector2.new()local aF=k:IsKeyDown(Enum.KeyCode.LeftShift)or k:IsKeyDown(Enum.KeyCode.RightShift)return(aE+aq)*64*a9*(aF and 0.25 or 1)*aD end;local function aG(V,aD)local aH=Vector2.new(af(ab.Thumbstick2.Y),af(-ab.Thumbstick2.X))*J/8;local aI=(ad.Delta+ae.PanDelta)*J/64;ad.Delta=Vector2.new()ae.PanDelta=Vector2.new()return(aH+aI)*8*aD end;local function aJ()local aH=(ab.ButtonX-ab.ButtonY)*0.25;local aK=ad.MouseWheel*1.0;local aL=(ae.PinchDelta-1.0)*-5.0;ad.MouseWheel=0;ae.PinchDelta=1.0;return aH+aK+aL end;local aM=false;local function aN(V)local aD=e.FreecamSensitivity.Value or 1;local aO=a3:Update(V,aC(V,aD))local aP=a4:Update(V,aG(V,aD))local aQ=a5:Update(V,aJ())local aR=M(N(L(70/2))/N(L(a8/2)))a8=P(a8+aQ*300*V/aR,1,120)a7=a7+aP*V/aR;a7=Vector2.new(P(a7.X,-R,R),a7.Y%(2*J))local aS=CFrame.new(a6)*CFrame.fromOrientation(a7.X,a7.Y,0)*CFrame.new(aO*V)a6=aS.Position;I.CFrame=aS;I.Focus=aS;I.FieldOfView=a8 end;local function aT()if aM then return end;local aS=I.CFrame;a7=Vector2.new(aS:toEulerAnglesYXZ())a6=aS.Position;a8=I.FieldOfView;a3:Reset(Vector3.new())a4:Reset(Vector2.new())a5:Reset(0)at()aA()I.CameraType=Enum.CameraType.Scriptable;k.MouseIconEnabled=false;k.MouseBehavior=Enum.MouseBehavior.LockCenter;al()g:BindToRenderStep("CerbFreecam",Enum.RenderPriority.Camera.Value,aN)aM=true end;local function aU()if not aM then return end;g:UnbindFromRenderStep("CerbFreecam")ap()aB()I.CameraType=Enum.CameraType.Custom;k.MouseBehavior=Enum.MouseBehavior.Default;k.MouseIconEnabled=true;ad.Delta=Vector2.new()ad.MouseWheel=0;aw()aM=false end;d.FreecamEnabled:OnChanged(function()if d.FreecamEnabled.Value then aT()else aU()end end)f:OnUnload(function()if d.InfiniteCamera and d.InfiniteCamera.Value then d.InfiniteCamera:SetValue(false)end;if d.NoFog and d.NoFog.Value then d.NoFog:SetValue(false)end;if d.XRay and d.XRay.Value then d.XRay:SetValue(false)end;if d.Fullbright and d.Fullbright.Value then d.Fullbright:SetValue(false)end;if d.FreecamEnabled and d.FreecamEnabled.Value then d.FreecamEnabled:SetValue(false)end;G()x()A(false)if aM then aU()end end)end
