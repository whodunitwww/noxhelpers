return function(a,b,c,d,e,f)local g=b.Player:AddLeftGroupbox("Click To Walk","mouse-pointer")g:AddToggle("ClickToWalk",{Text="Enable Click To Walk",Default=false})g:AddSlider("CTW_Speed",{Text="Walk Speed",Default=16,Min=8,Max=300,Rounding=0,Suffix=" studs/s"})local h=700;local i=0.30;local j=0;local k,l,m,n;local o;local p;local q;local r;local s=nil;local t=0;local u=false;local v=nil;local w={}local function x()local y=c.humanoid;if not y then return end;if v==nil then v=y.WalkSpeed end;y.WalkSpeed=e.CTW_Speed.Value end;local function z()local y=c.humanoid;if y and v~=nil then y.WalkSpeed=v end;v=nil end;local function A(B)if not B then return end;for C,D in ipairs(B:GetDescendants())do if D:IsA("BasePart")then a.TweenService:Create(D,TweenInfo.new(0.25),{Transparency=1}):Play()end end;task.delay(0.3,function()pcall(function()if B then B:Destroy()end end)end)end;local function E()if n then n:Disconnect()n=nil end;if q then A(q)q=nil end end;local function F()if p then A(p)p=nil end end;local function G()E()F()end;local function H()local y,I=c.humanoid,c.humanoidRootPart;if y then pcall(function()if I then y:MoveTo(I.Position)end end)pcall(function()y:Move(Vector3.zero)end)end end;local function J()if l then l:Disconnect()l=nil end;if m then m:Disconnect()m=nil end;o=nil end;local function K()for L,M in pairs(w)do if M then M:Disconnect()end;w[L]=nil end end;local function N()if not u then G()J()z()K()r,s,t=nil,nil,0;return end;u=false;H()G()J()z()K()r,s,t=nil,nil,0 end;local function O()N()if k then k:Disconnect()k=nil end end;local function P(Q)E()q=Instance.new("Folder")q.Name="CTW_Beacon"q.Parent=workspace;local R=Instance.new("Part")R.Name="Pillar"R.Anchored,R.CanCollide=true,false;R.Material=Enum.Material.Neon;R.Color=Color3.fromRGB(55,235,120)R.Size=Vector3.new(0.25,12,0.25)R.CFrame=CFrame.new(Q+Vector3.new(0,R.Size.Y/2,0))R.Parent=q;local S=Instance.new("Part")S.Name="Ring"S.Shape=Enum.PartType.Cylinder;S.Anchored,S.CanCollide=true,false;S.Material=Enum.Material.Neon;S.Color=Color3.fromRGB(55,235,120)S.Size=Vector3.new(2,0.2,2)S.CFrame=CFrame.new(Q)*CFrame.Angles(math.rad(90),0,0)S.Parent=q;local T=Instance.new("Part")T.Name="Glow"T.Anchored,T.CanCollide=true,false;T.Material=Enum.Material.Neon;T.Color=Color3.fromRGB(55,235,120)T.Transparency=0.5;T.Size=Vector3.new(1.5,0.15,1.5)T.CFrame=CFrame.new(Q+Vector3.new(0,0.05,0))T.Parent=q;a.TweenService:Create(S,TweenInfo.new(0.8,Enum.EasingStyle.Quad,Enum.EasingDirection.Out,-1,true),{Size=Vector3.new(6,S.Size.Y,6)}):Play()a.TweenService:Create(R,TweenInfo.new(0.8,Enum.EasingStyle.Sine,Enum.EasingDirection.InOut,-1,true),{Transparency=0.25}):Play()local U=0;n=a.RunService.Heartbeat:Connect(function(V)if not S or not S.Parent then return end;U=U+V*math.pi/2;S.CFrame=CFrame.new(Q)*CFrame.Angles(math.rad(90),U,0)end)end;local function W(X)F()p=Instance.new("Folder")p.Name="CTW_Path"p.Parent=workspace;for Y=1,#X do local Z=Instance.new("Part")Z.Name="CTW_Waypoint"Z.Anchored,Z.CanCollide=true,false;Z.Material=Enum.Material.Neon;Z.Color=Color3.fromRGB(55,235,120)Z.Size=Vector3.new(0.35,0.35,0.35)Z.Shape=Enum.PartType.Ball;Z.CFrame=CFrame.new(X[Y].Position+Vector3.new(0,0.15,0))Z.Parent=p end;for Y=1,#X-1 do local _,a0=X[Y].Position,X[Y+1].Position;local a1=Instance.new("Part")a1.Name="CTW_Segment"a1.Anchored,a1.CanCollide=true,false;a1.Material=Enum.Material.Neon;a1.Color=Color3.fromRGB(55,235,120)a1.Size=Vector3.new(0.15,0.15,(_-a0).Magnitude)a1.CFrame=CFrame.new((_+a0)/2,a0)a1.Transparency=1;a1.Parent=p;a.TweenService:Create(a1,TweenInfo.new(0.2),{Transparency=0}):Play()end end;local function a2(a3,a4)local a5=a4-a3;local a6=a5.Magnitude;if a6<1 then return{a4}end;local a7=a5.Unit;local a8,a9={},0;while a9+h<a6 do a9=a9+h;a8[#a8+1]=a3+a7*a9 end;a8[#a8+1]=a4;return a8 end;local function aa(ab,_,a0)local ac=os.clock()local ad=i-(ac-j)if ad>0 then task.wait(ad)end;j=os.clock()local ae,af=pcall(function()ab:ComputeAsync(_,a0)end)if not ae then return false,af end;return true end;local function ag()K()w.WASD=a.UserInputService.InputBegan:Connect(function(ah,ai)if ai then return end;local aj=ah.KeyCode;if aj==Enum.KeyCode.W or aj==Enum.KeyCode.A or aj==Enum.KeyCode.S or aj==Enum.KeyCode.D then N()end end)w.GP=a.UserInputService.InputChanged:Connect(function(ah,ai)if ai then return end;if ah.UserInputType==Enum.UserInputType.Gamepad1 and ah.KeyCode==Enum.KeyCode.Thumbstick1 then if ah.Position.Magnitude>0.15 then N()end end end)w.RMB=a.UserInputService.InputBegan:Connect(function(ah,ai)if ai then return end;if ah.UserInputType==Enum.UserInputType.MouseButton2 then N()end end)if c.player then w.CharAdded=c.player.CharacterAdded:Connect(function()N()end)end;local y=c.humanoid;if y then w.Died=y.Died:Connect(N)w.Seated=y.Seated:Connect(function(ak)if ak then N()end end)w.Ancestry=y.AncestryChanged:Connect(function(C,al)if al==nil then N()end end)end end;local function am(an,ao)if not u then return end;local ap=a.PathfindingService:CreatePath({AgentRadius=2,AgentHeight=5,AgentCanJump=true,WaypointSpacing=4})o=ap;local ae=aa(ap,an,ao)if not ae or ap.Status~=Enum.PathStatus.Success then local aq=an:Lerp(ao,0.5)ae=aa(ap,an,aq)if not ae or ap.Status~=Enum.PathStatus.Success then f:Notify("Unable to compute path.",3)N()return else if s then table.insert(s,t,aq)end end end;if not u then return end;local ar=ap:GetWaypoints()if#ar==0 then f:Notify("No waypoints for this segment.",3)N()return end;W(ar)if m then m:Disconnect()m=nil end;m=ap.Blocked:Connect(function()if not u then return end;local I=c.humanoidRootPart;if I and r and s then am(I.Position,s[t])end end)if l then l:Disconnect()l=nil end;local Y=1;local y=c.humanoid;if not y then N()return end;y:MoveTo(ar[Y].Position)l=y.MoveToFinished:Connect(function(as)if not u then return end;if o~=ap then return end;if not as then local I=c.humanoidRootPart;if I and s then am(I.Position,s[t])else N()end;return end;Y=Y+1;if ar[Y]then y:MoveTo(ar[Y].Position)else t=t+1;if s and s[t]then local I=c.humanoidRootPart;if I then am(I.Position,s[t])else N()end else N()end end end)end;local function at()if k then return end;k=a.UserInputService.InputBegan:Connect(function(ah,ai)if ai then return end;if ah.UserInputType~=Enum.UserInputType.MouseButton1 then return end;local au=c.player and c.player:GetMouse()if not au or not au.Hit then return end;local a4=au.Hit.Position;if u then N()end;r=a4;G()P(a4)local I=c.humanoidRootPart;local y=c.humanoid;if not(I and y)then N()return end;u=true;x()ag()s=a2(I.Position,a4)t=1;am(I.Position,s[t])end)end;d.ClickToWalk:OnChanged(function()if d.ClickToWalk.Value then at()else O()end end)e.CTW_Speed:OnChanged(function(av)if u and c.humanoid then c.humanoid.WalkSpeed=av end end)end
