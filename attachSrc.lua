return function(a)local b,c,d,e,f,g=a.Services,a.Tabs,a.References,a.Library,a.Options,a.Toggles;local h,i,j=a.MoveToPos,a.PREFIX or"NH_",a.Config or{}local k=j.DodgeConfig or{}local l=j.AutoYOffsetConfig or{}local m=j.TargetTypes or{Players={key="Players"},Entities={key="Entities"}}local n=j.Defaults or{mode="Aligned",yOffset=10,horizDist=4,targetType="Players"}local o=j.UIText or{groupTitle="AutoFarm",statusTitle="AutoFarm Status"}local p=j.Move or{approachMaxSecs=12,reachDistance=3,moveForceResp=80,moveMaxVelocity=120,orientResp=120,approachSpeed=1000}local q=j.Perf or{scanCooldown=0.5,waitScanHz=4,statusHz=5}local r=j.Overrides or{}local s=j.ServerHop or{}local t=function(u,v)if e and e.Notify then e:Notify(u,v or 3)end end;local w={mode=n.mode,yOffset=n.yOffset,horizDist=n.horizDist,targetType=n.targetType,selectedTargets={},currentInst=nil,running=false,_phase="Idle",_hb=nil,_watchSelf=nil,_moveCleanup=nil,dodgeMode=n.dodgeMode,autoYOffset=n.autoYOffset,_dodgeActive=false,_dodgeConns={},_dodgeScanHB=nil,_dodgeRange=50,showStatus=n.showStatus,_statusHB=nil,_statusDiedConn=nil,_statusLastTarget=nil,_statusLastHealth=nil,_statusGui=nil,_statusBar=nil,_statusText=nil,_hoverAP=nil,_hoverAO=nil,_hoverA0=nil,_hoverA1=nil,_hoverNoclipHB=nil,_idleAnchor=nil,_instToLabel={},_labelToList={},overridesEnabled=false,overrideSelection={},activeOverride=nil,_overrideHB=nil,serverHopEnabled=false,_lastHopTime=0,_camGhostHB=nil,_camTouched={},_prevOcclusion=nil,_targetFX=nil}local function x(y)if not(y and y.Parent)then return false end;local z=y:FindFirstChildOfClass("Humanoid")if z then return z.Health>0 end;if y:IsA("Player")then local A=y.Character;local B=A and A:FindFirstChildOfClass("Humanoid")return A and B and B.Health>0 or false end;return(y:FindFirstChild("HumanoidRootPart")or y:FindFirstChildWhichIsA("BasePart"))~=nil end;local function C(D)if not D then return end;if D:IsA("Player")then local A=D.Character;return A and A:FindFirstChild("HumanoidRootPart")end;return D:FindFirstChild("HumanoidRootPart")or D:FindFirstChildWhichIsA("BasePart")end;local function E(D)if not D then return end;if D:IsA("Player")then local A=D.Character;return A and A:FindFirstChildOfClass("Humanoid")end;if D:IsA("Model")then return D:FindFirstChildOfClass("Humanoid")end end;local function F(y)if not y then return"nil"end;if y:IsA("Player")then return y.DisplayName~=""and y.DisplayName or y.Name end;return y.Name end;local function G(H,I,J,K)local L,M=H.LookVector,H.RightVector;local N=Vector3.new(0,K,0)if I=="Behind"then return-L*J+N elseif I=="In Front"then return L*J+N elseif I=="Left"then return-M*J+N elseif I=="Right"then return M*J+N else return N end end;local function O(P)local Q={}for R in string.gmatch(P or"","[^/]+")do Q[#Q+1]=R end;return Q end;local function S(T,P)if not T then return nil end;local Q=O(P)if#Q==0 then return nil end;local U=T;if Q[1]=="Workspace"then table.remove(Q,1)end;for V,R in ipairs(Q)do U=U:FindFirstChild(R)if not U then return nil end end;return U end;local function W(X,Y)if not Y then return true end;X=tostring(X or"")local Z=Y.caseInsensitive;if Y.names then for V,_ in ipairs(Y.names)do if Z then if string.lower(X)==string.lower(_)then return true end else if X==_ then return true end end end;return false end;if Y.patterns then for V,a0 in ipairs(Y.patterns)do local a1=Z and string.lower(X)or X;local a2=Z and string.lower(a0)or a0;local a3,a4=pcall(string.find,a1,a2)if a3 and a4 then return true end end;return false end;return true end;local function a5(a6,Y)if not Y then return a6 end;local a7={}for _,a8 in pairs(a6)do local a9=true;if Y.include then a9=Y.include[_]==true end;if Y.exclude and Y.exclude[_]then a9=false end;if a9 then a7[_]=a8 end end;return a7 end;local function aa(a6,ab,y)a6[ab]=a6[ab]or{}table.insert(a6[ab],y)end;local function ac()local ad={}for V,P in ipairs(b.Players:GetPlayers())do if P~=d.player then ad[P.DisplayName~=""and P.DisplayName or P.Name]={P}end end;return ad end;local function ae()local ad={}for V,af in ipairs(b.Workspace:GetDescendants())do if af:IsA("Model")and not b.Players:GetPlayerFromCharacter(af)then local z=af:FindFirstChildOfClass("Humanoid")if z then aa(ad,af.Name,af)end end end;return ad end;local function ag(ah,ai)ai=ai or{}local T=S(b.Workspace,ah)local ad={}if not T then return ad end;for V,af in ipairs(T:GetDescendants())do if ai.modelsOnly and af:IsA("Model")then if not ai.humanoidsOnly or af:FindFirstChildOfClass("Humanoid")then if W(af.Name,ai)and(not ai.filter or ai.filter(af))then aa(ad,af.Name,af)end end elseif not ai.modelsOnly then if W(af.Name,ai)and(not ai.filter or ai.filter(af))then aa(ad,af.Name,af)end end end;return ad end;local aj,ak={},tonumber(q.scanCooldown)or 0.5;local function al(ab)local am=aj[ab]if am and os.clock()-am.t<ak then return am.res end end;local function an(ab,ad)aj[ab]={t=os.clock(),res=ad}end;local function ao(ap,Y)local aq=al(ap)if aq then return aq end;local ad={}if Y.getItems then local a3,a6=pcall(Y.getItems,b,d)ad=a3 and(a6 or{})or{}elseif Y.folderPath then ad=ag(Y.folderPath,Y)elseif Y.key=="Players"then ad=ac()elseif Y.key=="Entities"then local ar=ae()if Y.names or Y.patterns then local as={}for _,a8 in pairs(ar)do if W(_,Y)then as[_]=a8 end end;ad=as else ad=ar end else ad={}end;ad=a5(ad,Y)w._labelToList,w._instToLabel=ad,{}for at,a8 in pairs(ad)do for V,y in ipairs(a8)do w._instToLabel[y]=at end end;an(ap,ad)return ad end;local function au(ap)local Y=m[ap]if not Y then return{}end;return ao(ap,Y)end;local function av(aw)local ax;for V,P in ipairs(b.Players:GetPlayers())do if P~=d.player then local A=P.Character;local ay=A and A:FindFirstChild("HumanoidRootPart")if ay then local af=(ay.Position-aw).Magnitude;if not ax or af<ax then ax=af end end end end;return ax or math.huge end;local function az(y)if not(g.AF_Safety and g.AF_Safety.Value)then return true end;local aA=C(y)if not aA then return false end;local aB=f.AF_SafetyRange and f.AF_SafetyRange.Value or 50;return av(aA.Position)>aB end;local function aC()local a6=au(w.targetType)local aD={}for V,X in ipairs(w.selectedTargets or{})do local a8=a6[X]if a8 then for V,y in ipairs(a8)do if x(y)and az(y)then aD[#aD+1]=y end end end end;return aD end;local function aE(a8)local ay=d.humanoidRootPart;if not ay or not a8 or#a8==0 then return end;local ax,aF;for V,y in ipairs(a8)do local aG=C(y)if aG then local af=(aG.Position-ay.Position).Magnitude;if not aF or af<aF then ax,aF=y,af end end end;return ax end;local function aH()local aI={}for X,Y in pairs(r)do if w.overrideSelection[X]then aI[#aI+1]={name=X,def=Y,pr=tonumber(Y.priority)or 0}end end;table.sort(aI,function(aJ,aK)return aJ.pr>aK.pr end)return aI end;local function aL()if not w.overridesEnabled then return{}end;local a7={}for V,aM in ipairs(aH())do local a3,a8=pcall(function()local L=aM.def.getCandidates;if type(L)=="function"then return L(b,d)end end)if a3 and type(a8)=="table"then for V,y in ipairs(a8)do a7[#a7+1]=y end end end;return a7 end;local function aN()if w.activeOverride then local aO=w.activeOverride;w.activeOverride=nil;if w._overrideHB then pcall(function()w._overrideHB:Disconnect()end)end;w._overrideHB=nil;if aO.cleanup then pcall(aO.cleanup)end;if aO.def and aO.def.cancel then pcall(aO.def.cancel)end end end;local function aP()if not w.overridesEnabled or w.activeOverride then return false end;for V,aM in ipairs(aH())do local a3,aQ=pcall(function()return type(aM.def.shouldTrigger)=="function"and aM.def.shouldTrigger(b,d)or false end)if a3 and aQ then local aR;pcall(function()if type(aM.def.begin)=="function"then aR=aM.def.begin(b,d,a,w)end end)w.activeOverride={name=aM.name,def=aM.def,cleanup=aR}w._overrideHB=b.RunService.Heartbeat:Connect(function(aS)if not w.activeOverride then return end;local aO=w.activeOverride;if type(aO.def.step)=="function"then pcall(aO.def.step,aS,b,d,a,w)end;local aT=false;if type(aO.def.isComplete)=="function"then local aU,af=pcall(aO.def.isComplete,b,d,a,w)aT=aU and af==true end;if aT then aN()end end)return true end end;return false end;local function aV()if w.overridesEnabled and not w.activeOverride then local aW=aL()if#aW>0 then return aE(aW)end end;return aE(aC())end;local aX=setmetatable({},{__mode="k"})local aY={}local function aZ()for z,a_ in pairs(aY)do if a_ then pcall(function()a_:Disconnect()end)end;aY[z]=nil end;aX=setmetatable({},{__mode="k"})end;local function b0()aZ()if w._dodgeScanHB then pcall(function()w._dodgeScanHB:Disconnect()end)end;w._dodgeScanHB=nil;w._dodgeActive=false;if w._dodgeConns then for V,am in ipairs(w._dodgeConns)do pcall(function()am:Disconnect()end)end end;w._dodgeConns={}end;local function b1(b2,v)if w._dodgeActive then return end;w._dodgeActive=true;local b3=w.yOffset;w.yOffset=b2;task.delay(v,function()if w._dodgeActive then w.yOffset=b3;w._dodgeActive=false end end)end;local function b4(y)local ay=d.humanoidRootPart;local aG=C(y)if not(ay and aG)then return false end;local M=w._dodgeRange or 50;return(aG.Position-ay.Position).Magnitude<=M end;local function b5(z)if not z or aY[z]then return end;local b6=b.Players:GetPlayerFromCharacter(z.Parent)~=nil;if b6 then return end;aY[z]=z.AnimationPlayed:Connect(function(b7)local b8=b7 and b7.Animation;local b9=b8 and b8.AnimationId or""local ba=tonumber(string.match(b9,"%d+"))if not ba then return end;local bb=k[ba]if not bb then return end;if not b4(z.Parent)then return end;local bc=tonumber(bb.delay)or 0;local bd=tonumber(bb.dodgeY)or w.yOffset;local be=tonumber(bb.duration)or 0.5;task.delay(bc,function()if w.dodgeMode and b4(z.Parent)then b1(bd,be)end end)end)end;local bf,bg;local function bh()b0()if not w.dodgeMode then return end;for V,af in ipairs(b.Workspace:GetDescendants())do if af:IsA("Humanoid")then aX[af]=true;b5(af)end end;bf=b.Workspace.DescendantAdded:Connect(function(af)if not w.dodgeMode then return end;if af:IsA("Humanoid")then aX[af]=true;b5(af)end end)bg=b.Workspace.DescendantRemoving:Connect(function(af)if af:IsA("Humanoid")then aX[af]=nil;local am=aY[af]if am then pcall(function()am:Disconnect()end)end;aY[af]=nil end end)table.insert(w._dodgeConns,bf)table.insert(w._dodgeConns,bg)end;local function bi(D)if w._dodgeActive then return end;if not(w.autoYOffset and D)then return end;local at=w._instToLabel[D]if not at then return end;for ab,bj in pairs(l)do if tostring(at):find(ab,1,true)then if type(bj)=="number"then w.yOffset=bj elseif type(bj)=="table"then if bj.y~=nil then w.yOffset=tonumber(bj.y)or w.yOffset end;if bj.mode and type(bj.mode)=="string"then w.mode=bj.mode end end;return end end end;local function bk()if w._statusGui then pcall(function()w._statusGui:Destroy()end)end;w._statusGui,w._statusBar,w._statusText=nil,nil,nil end;local function bl()if w._statusGui and w._statusGui.Parent then return end;local bm=b.Players.LocalPlayer:FindFirstChildOfClass("PlayerGui")if not bm then return end;local bn=Instance.new("ScreenGui")bn.Name=i.."AF_Status"bn.ResetOnSpawn=false;bn.ZIndexBehavior=Enum.ZIndexBehavior.Sibling;bn.Parent=bm;local bo=Instance.new("Frame")bo.Name="Panel"bo.AnchorPoint=Vector2.new(0,0)bo.Position=UDim2.fromOffset(12,100)bo.Size=UDim2.fromOffset(240,62)bo.BackgroundColor3=Color3.fromRGB(18,18,18)bo.BackgroundTransparency=0.2;bo.BorderSizePixel=0;bo.Parent=bn;local bp=Instance.new("UICorner")bp.CornerRadius=UDim.new(0,10)bp.Parent=bo;local bq=Instance.new("TextLabel")bq.Name="Title"bq.Size=UDim2.new(1,-10,0,22)bq.Position=UDim2.fromOffset(8,6)bq.BackgroundTransparency=1;bq.Font=Enum.Font.GothamSemibold;bq.TextSize=14;bq.TextXAlignment=Enum.TextXAlignment.Left;bq.TextColor3=Color3.fromRGB(200,255,200)bq.Text=o.statusTitle or"AutoFarm Status"bq.Parent=bo;local br=Instance.new("TextLabel")br.Name="HPText"br.Size=UDim2.new(1,-10,0,18)br.Position=UDim2.fromOffset(8,28)br.BackgroundTransparency=1;br.Font=Enum.Font.Gotham;br.TextSize=13;br.TextXAlignment=Enum.TextXAlignment.Left;br.TextColor3=Color3.fromRGB(230,230,230)br.Text="Target: —  HP: —/—"br.Parent=bo;local bs=Instance.new("Frame")bs.Name="BarBG"bs.Size=UDim2.fromOffset(224,8)bs.Position=UDim2.fromOffset(8,48)bs.BackgroundColor3=Color3.fromRGB(45,45,45)bs.BorderSizePixel=0;bs.Parent=bo;local bt=Instance.new("UICorner")bt.CornerRadius=UDim.new(0,4)bt.Parent=bs;local bu=Instance.new("Frame")bu.Name="Bar"bu.Size=UDim2.new(0,0,1,0)bu.BackgroundColor3=Color3.fromRGB(50,205,50)bu.BorderSizePixel=0;bu.Parent=bs;local bv=Instance.new("UICorner")bv.CornerRadius=UDim.new(0,4)bv.Parent=bu;w._statusGui,w._statusBar,w._statusText=bn,bu,br end;local function bw(D,bx,by)if not(w._statusGui and w._statusGui.Parent)then return end;local aG,aK=w._statusText,w._statusBar;if not(aG and aK)then return end;local B,bz=tonumber(bx)or 0,tonumber(by)or 0;local bA=bz>0 and math.clamp(B/bz,0,1)or 0;aG.Text=("Target: %s    HP: %d/%d"):format(D and F(D)or"—",B,bz)aK.Size=UDim2.new(bA,0,1,0)end;local function bB()if w._statusHB then pcall(function()w._statusHB:Disconnect()end)w._statusHB=nil end;if w._statusDiedConn then pcall(function()w._statusDiedConn:Disconnect()end)w._statusDiedConn=nil end;w._statusLastTarget,w._statusLastHealth=nil,nil;bk()end;local function bC(D)if w._statusDiedConn then pcall(function()w._statusDiedConn:Disconnect()end)w._statusDiedConn=nil end;local z=E(D)if z then w._statusDiedConn=z.Died:Connect(function()local bD=aV()if bD and bD~=D then w.currentInst=bD;if w._phase~="Approach"and w.running then startApproach()end end end)end end;local function bE()bB()if not w.showStatus then return end;bl()local bF,bG=0,1/math.max(1,tonumber(q.statusHz)or 5)w._statusHB=b.RunService.Heartbeat:Connect(function()if not w.showStatus then return end;bF=bF+b.RunService.Heartbeat:Wait()if bF<bG then return end;bF=0;local bH=w.currentInst;if bH~=w._statusLastTarget then w._statusLastTarget,w._statusLastHealth=bH,nil;if bH then bC(bH)end end;if not bH then bw(nil,0,0)return end;local z=E(bH)if z then local bx,bz=math.floor(z.Health),math.floor(z.MaxHealth or 0)if bx~=w._statusLastHealth then w._statusLastHealth=bx;bw(bH,bx,bz)end else bw(bH,0,0)end end)end;local function bI()for V,bJ in ipairs({w._hoverAP,w._hoverAO,w._hoverA0,w._hoverA1})do if bJ then pcall(function()bJ:Destroy()end)end end;w._hoverAP,w._hoverAO,w._hoverA0,w._hoverA1=nil,nil,nil,nil;if w._hoverNoclipHB then pcall(function()w._hoverNoclipHB:Disconnect()end)end;w._hoverNoclipHB=nil;if w._idleAnchor then pcall(function()w._idleAnchor:Destroy()end)end;w._idleAnchor=nil end;local function bK()local bL=d.character;if not bL then return end;for V,af in ipairs(bL:GetDescendants())do if af:IsA("BasePart")then af.CanCollide=false end end end;local function bM()for aA,V in pairs(w._camTouched)do if aA and aA.Parent then pcall(function()aA.LocalTransparencyModifier=0 end)end end;w._camTouched={}end;local function bN()if w._camGhostHB then pcall(function()w._camGhostHB:Disconnect()end)end;w._camGhostHB=nil;bM()local bO=b.Players.LocalPlayer;if w._prevOcclusion~=nil then pcall(function()bO.DevCameraOcclusionMode=w._prevOcclusion end)end;w._prevOcclusion=nil end;local function bP()bN()local bQ=workspace.CurrentCamera;local bO=b.Players.LocalPlayer;w._prevOcclusion=bO.DevCameraOcclusionMode;pcall(function()bO.DevCameraOcclusionMode=Enum.DevCameraOcclusionMode.Invisicam end)w._camGhostHB=b.RunService.RenderStepped:Connect(function()local bR=d.humanoidRootPart;if not(bQ and bR)then bM()return end;local bS=d.character and d.character:FindFirstChild("Head")local bT=bS and bS.Position or bR.Position;local bU=bQ.CFrame.Position;local bV={}if d.character then for V,af in ipairs(d.character:GetDescendants())do if af:IsA("BasePart")then table.insert(bV,af)end end end;local Q={}pcall(function()Q=bQ:GetPartsObscuringTarget({bT},bV)end)local bW={}for V,aA in ipairs(Q or{})do if aA and aA:IsA("BasePart")then bW[aA]=true;if not w._camTouched[aA]then w._camTouched[aA]=true;pcall(function()aA.LocalTransparencyModifier=0.75 end)end end end;for bX,V in pairs(w._camTouched)do if not bW[bX]then w._camTouched[bX]=nil;if bX and bX.Parent then pcall(function()bX.LocalTransparencyModifier=0 end)end end end end)end;local function bY()if w._targetFX then pcall(function()w._targetFX:Destroy()end)end;w._targetFX=nil end;local function bZ(y)if not y then return nil end;if y:IsA("Player")then return y.Character end;if y:IsA("Model")then return y end;local ay=C(y)return ay end;local function b_(D)local c0=bZ(D)if not c0 then bY()return end;if not w._targetFX or not w._targetFX.Parent then local B=Instance.new("Highlight")B.Name=i.."AF_TargetAura"B.FillTransparency=0.7;B.OutlineTransparency=0;B.FillColor=Color3.fromRGB(50,205,50)B.OutlineColor=Color3.fromRGB(20,80,20)B.DepthMode=Enum.HighlightDepthMode.AlwaysOnTop;B.Parent=b.CoreGui or b.Players.LocalPlayer:FindFirstChildOfClass("PlayerGui")w._targetFX=B end;w._targetFX.Adornee=c0 end;local function c1()bI()w._phase="IdleHover"local c2=d.humanoidRootPart;if not c2 then return end;if d.humanoid then d.humanoid.AutoRotate=false end;c2.AssemblyAngularVelocity=Vector3.zero;local c3=Instance.new("Part")c3.Name=i.."AF_IdleAnchor"c3.Size=Vector3.new(1,1,1)c3.CFrame=c2.CFrame+Vector3.new(0,w.yOffset,0)c3.Anchored=true;c3.Transparency=1;c3.CanCollide=false;c3.Parent=b.Workspace;w._idleAnchor=c3;local c4=Instance.new("Attachment")c4.Name=i.."AF_A0"c4.Parent=c2;local c5=Instance.new("Attachment")c5.Name=i.."AF_A1"c5.Parent=c3;local c6=Instance.new("AlignPosition")c6.Name=i.."AF_AP"c6.Mode=Enum.PositionAlignmentMode.TwoAttachment;c6.Attachment0=c4;c6.Attachment1=c5;c6.Responsiveness=p.moveForceResp or 80;c6.MaxVelocity=p.moveMaxVelocity or 120;c6.MaxForce=math.huge;c6.Parent=c2;local c7=Instance.new("AlignOrientation")c7.Name=i.."AF_AO"c7.Mode=Enum.OrientationAlignmentMode.OneAttachment;c7.Attachment0=c4;c7.Responsiveness=p.orientResp or 120;c7.MaxTorque=math.huge;c7.RigidityEnabled=true;c7.Parent=c2;w._hoverAP,w._hoverAO,w._hoverA0,w._hoverA1=c6,c7,c4,c5;bK()w._hoverNoclipHB=b.RunService.Stepped:Connect(bK)end;local function c8()if w._hb then pcall(function()w._hb:Disconnect()end)w._hb=nil end;w._phase="Waiting"c1()bY()local bF,bG=0,1/math.max(1,tonumber(q.waitScanHz)or 4)w._hb=b.RunService.Heartbeat:Connect(function(aS)if not w.running then return end;if w.overridesEnabled and not w.activeOverride then pcall(aP)end;bF=bF+aS;if bF<bG then return end;bF=0;local bD=aV()if bD then w.currentInst=bD;startApproach()return end;if w.serverHopEnabled and type(s.hop)=="function"then local c9=os.clock()local ca=tonumber(s.cooldown)or 6;if c9-(w._lastHopTime or 0)>=ca then w._lastHopTime=c9;pcall(function()s.hop(b,d,a,w)end)end end end)end;function startApproach()if w._hb then pcall(function()w._hb:Disconnect()end)w._hb=nil end;bI()w._phase="Approach"local bH=w.currentInst;if not bH then local cb=aV()if not cb then c8()return end;bH=cb;w.currentInst=cb end;bi(bH)if w.showStatus then bE()end;bh()b_(bH)local function cc()if not x(bH)then return true end;if not az(bH)then return true end;return false end;local function cd()if cc()then return nil end;local aG=C(bH)if not aG then return nil end;return aG.Position+G(aG.CFrame,w.mode,w.horizDist,w.yOffset)end;local ce=cd()if not ce then c8()return end;w._moveCleanup=h(ce,tonumber(p.approachSpeed)or 1000,cd)local cf=os.clock()w._hb=b.RunService.Heartbeat:Connect(function()if w._phase~="Approach"then return end;local c2=d.humanoidRootPart;if not c2 then return end;b_(w.currentInst)local cg=cd()if not cg then local bD=aV()if bD then w.currentInst=bD;startApproach()else c8()end;return end;if(c2.Position-cg).Magnitude<=(p.reachDistance or 3)then if w._moveCleanup then pcall(w._moveCleanup)w._moveCleanup=nil end;w._phase="Hover"task.defer(function()if w.running then task.wait(0.05)startHover()end end)return end;if os.clock()-cf>(p.approachMaxSecs or 12)then c8()return end;if not x(bH)or not az(bH)then local bD=aV()if bD then w.currentInst,bH=bD,bD else c8()end end end)end;function startHover()if w._hb then pcall(function()w._hb:Disconnect()end)w._hb=nil end;bI()w._phase="Hover"local c2,bH,ch=d.humanoidRootPart,w.currentInst,nil;ch=C(bH)if not(c2 and ch and x(bH)and az(bH))then c8()return end;if d.humanoid then d.humanoid.AutoRotate=false end;c2.AssemblyAngularVelocity=Vector3.zero;b_(bH)local c4=Instance.new("Attachment")c4.Name=i.."AF_HoverA0"c4.Parent=c2;local c5=Instance.new("Attachment")c5.Name=i.."AF_HoverA1"c5.Parent=ch;local c6=Instance.new("AlignPosition")c6.Name=i.."AF_HoverAP"c6.Mode=Enum.PositionAlignmentMode.TwoAttachment;c6.Attachment0=c4;c6.Attachment1=c5;c6.Responsiveness=p.moveForceResp or 80;c6.MaxVelocity=p.moveMaxVelocity or 120;c6.MaxForce=math.huge;c6.Parent=c2;local c7=Instance.new("AlignOrientation")c7.Name=i.."AF_HoverAO"c7.Mode=Enum.OrientationAlignmentMode.OneAttachment;c7.Attachment0=c4;c7.Responsiveness=p.orientResp or 120;c7.MaxTorque=math.huge;c7.RigidityEnabled=true;c7.Parent=c2;w._hoverAP,w._hoverAO,w._hoverA0,w._hoverA1=c6,c7,c4,c5;local function ci()local cj=C(w.currentInst)if not cj then return end;if not w._dodgeActive then bi(w.currentInst)end;local H=cj.CFrame;local ck=G(H,w.mode,w.horizDist,w.yOffset)c5.Position=H:VectorToObjectSpace(ck)end;local function cl()local cm,cn,cj=w.currentInst,d.humanoidRootPart,C(w.currentInst)if not(cm and x(cm)and cn and cj and az(cm))then c8()return end;local co,cp=cn.Position,cj.Position;local cq=cp-co;local cr=cq.Magnitude;if cr<1e-6 then return end;cq=cq/cr;local N=Vector3.yAxis;if math.abs(cq:Dot(N))>0.98 then N=Vector3.xAxis end;local cs=CFrame.lookAt(co,cp,N)w._hoverAO.CFrame=cs end;ci()cl()bK()w._hoverNoclipHB=b.RunService.Stepped:Connect(bK)w._hb=b.RunService.RenderStepped:Connect(function()if not w.running then return end;ci()cl()b_(w.currentInst)if not az(w.currentInst)then local bD=aV()if bD and bD~=w.currentInst then w.currentInst=bD;startApproach()else c8()end end end)end;local function ct()if w._hb then pcall(function()w._hb:Disconnect()end)w._hb=nil end;if w._overrideHB then pcall(function()w._overrideHB:Disconnect()end)w._overrideHB=nil end end;local function cu()ct()bI()if d.humanoid then d.humanoid.AutoRotate=true end;w._phase="Idle"end;local function cv()aN()cu()ct()bB()b0()bY()if w.running then task.wait(0.25)w.currentInst=nil;c8()end end;local function cw()if w._watchSelf then w._watchSelf:Disconnect()w._watchSelf=nil end end;local function cx()cw()w._watchSelf=b.Players.LocalPlayer.CharacterAdded:Connect(function()task.wait(0.35)cv()end)end;local cy=c and(c["Auto"]or c.AddTab and c:AddTab("Auto"))if not cy then error("Auto tab unavailable")end;local cz=cy:AddRightGroupbox(o.groupTitle or"AutoFarm","link")local cA,cB;local function cC(cD)local a6=au(w.targetType)local cE={}for _,cF in pairs(a6)do if cF and#cF>0 then cE[#cE+1]=_ end end;table.sort(cE)cD:SetValues(cE)end;do local cG={}for cH,V in pairs(m)do cG[#cG+1]=cH end;table.sort(cG)cz:AddDropdown("AF_Type",{Text="Target Type",Values=cG,Default=n.targetType or cG[1],Callback=function(bJ)w.targetType=bJ;w.selectedTargets={}if cA then cC(cA)end end})end;cA=cz:AddDropdown("AF_Target",{Text="Target",Values={},Multi=true,Callback=function(bJ)local aD={}for X,cI in pairs(bJ)do if cI then aD[#aD+1]=X end end;w.selectedTargets=aD;if w.running then local bD=aV()if bD then w.currentInst=bD;startApproach()else c8()end end end})cz:AddButton({Text="Refresh Targets",Func=function()cC(cA)end})cz:AddDropdown("AF_Mode",{Text="Mode",Values={"Behind","In Front","Left","Right","Aligned"},Default=n.mode or"Behind",Callback=function(bJ)w.mode=bJ;if w.running then startApproach()end end})cz:AddSlider("AF_Y",{Text="Y Offset",Default=n.yOffset or 10,Min=-30,Max=30,Suffix=" studs",Callback=function(bJ)w.yOffset=bJ;if w.running then startApproach()end end})cz:AddToggle("AF_On",{Text="AutoFarm",Default=false,Callback=function(cI)w.running=cI;if cI then cx()bh()bP()w.currentInst=aV()if not w.currentInst then c8()else startApproach()end;if w.showStatus then bE()end else aN()cu()cw()bB()b0()ct()bN()bY()end end})cz:AddToggle("AF_Dodge",{Text="Dodge Mode",Default=n.dodgeMode or false,Callback=function(bJ)w.dodgeMode=bJ;if bJ then bh()else b0()end end})cz:AddSlider("AF_DodgeRange",{Text="Dodge Range",Default=50,Min=10,Max=200,Suffix=" studs",Callback=function(bJ)w._dodgeRange=bJ end})cz:AddToggle("AF_AutoY",{Text="AutoSet Y Offset",Default=n.autoYOffset or false,Callback=function(bJ)w.autoYOffset=bJ end})cz:AddToggle("AF_Status",{Text="Show Status",Default=n.showStatus or false,Callback=function(cI)w.showStatus=cI;if cI then bE()else bB()end end})cz:AddToggle("AF_Safety",{Text="Safety Mode",Default=false,Tooltip="Ignore targets close to other players."})cz:AddSlider("AF_SafetyRange",{Text="Safety Range",Default=50,Min=10,Max=200,Suffix=" studs"})cC(cA)local cJ={}function cJ.Unload()aN()cu()ct()bB()b0()cw()bN()bY()if g and g.AF_On and g.AF_On.Value then pcall(function()g.AF_On:SetValue(false)end)end end;return cJ end
