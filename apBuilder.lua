local a=game:GetService("Players")local b=game:GetService("Workspace")local c=game:GetService("HttpService")local d=game:GetService("MarketplaceService")local e=game:GetService("UserInputService")local f=a.LocalPlayer;return function(g)g=g or{}local h=loadstring(game:HttpGet("https://raw.githubusercontent.com/whodunitwww/noxhelpers/refs/heads/main/apUi.lua"))()local i=g.GameDir or"Cerberus/Universal"local j=i.."/AP_Config.json"local k=i.."/AP_Config_Extra.json"local l=i.."/AP_AnimLog.json"local m=i.."/AP_AllAnims.json"local n=i.."/AP_IgnoreAnims.json"local o=g.DefaultConfig or{["17030773401"]={name="Zombie Attack",startSec=0.42,hold=0.30,rollOnFail=true,distanceAdj=0},["9876543210"]={name="Lunge",startSec=0.41,hold=0.30,rollOnFail=false,distanceAdj=0}}local p=g.DefaultExtra or{parryKey="F",rollKey="Q"}local q={}local r={}local s={}local t={}local u={}local v;local function w(x)local y=string.match(x,"^(.*)/[^/]+$")if y and makefolder then pcall(makefolder,y)end end;local function z(x,A)if not isfile or not isfile(x)then return table.clone(A)end;local B,C=pcall(readfile,x)if not B or type(C)~="string"or C==""then return table.clone(A)end;local D,E=pcall(function()return c:JSONDecode(C)end)if not D or type(E)~="table"then return table.clone(A)end;return E end;local function F(x,G)if not writefile then return end;w(x)local B,H=pcall(function()return c:JSONEncode(G)end)if B then pcall(writefile,x,H)end end;local function I()q=z(j,o)r=z(k,p)t=z(n,{})end;local function J()F(j,q)F(k,r)F(n,t)end;if not(isfile and isfile(j))then I()J()else I()end;local K=true;local L=40;local M=false;local N=false;local O=false;local P={}local function Q(R,S)local T,U,V=R.X-S.X,R.Y-S.Y,R.Z-S.Z;return T*T+U*U+V*V end;local function W(X)if not f or not f.Character then return false end;local Y=X:FindFirstChild("HumanoidRootPart")or X.PrimaryPart;local Z=f.Character:FindFirstChild("HumanoidRootPart")if not(Y and Z)then return false end;return Q(Y.Position,Z.Position)<=L*L end;local function _(a0)local a1=a0.Animation and a0.Animation.AnimationId or""local a2=tostring(a1):match("%d+")return a2 end;local a3={}local function a4(a5,a0)a5=tostring(a5 or"")local a6=a3[a5]if a6 and a6~=""then return a6 end;local a7;if a0 then local a8=a0.Animation;if a8 and a8.Name and a8.Name~=""and a8.Name~="Animation"then a7=a8.Name elseif a0.Name and a0.Name~=""and a0.Name~="Animation"and a0.Name~="AnimationTrack"then a7=a0.Name end end;if not a7 and q[a5]and q[a5].name and q[a5].name~=""then a7=q[a5].name end;if not a7 then local a9=tonumber(a5)if a9 then local B,aa=pcall(function()return d:GetProductInfo(a9,Enum.InfoType.Asset)end)if B and aa and type(aa)=="table"and aa.Name and aa.Name~=""then a7=aa.Name end end end;if not a7 or a7==""then a7="Anim "..a5 end;a3[a5]=a7;return a7 end;local function ab(a5,ac,a0)local ad=os.clock()local ae=a4(a5,a0)local af=s[a5]if not af then af={id=a5,count=0,lastSeenTime=ad,lastSourceName=ac and ac.Name or"",name=ae}s[a5]=af end;af.count=(af.count or 0)+1;af.lastSeenTime=ad;af.lastSourceName=ac and ac.Name or af.lastSourceName;af.name=ae;if M and writefile then local ag={}if isfile and isfile(l)then local B,H=pcall(readfile,l)if B and H and H~=""then local D,ah=pcall(c.JSONDecode,c,H)if D and type(ah)=="table"then ag=ah end end end;table.insert(ag,{id=a5,name=ae,src=ac and ac:GetFullName()or"",t=ad})F(l,ag)end end;local function ai(aj)if P[aj]then return end;local ak;ak=aj.AnimationPlayed:Connect(function(a0)if not K then return end;local X=aj.Parent;if not X or not X:IsDescendantOf(b)then return end;if f and X==f.Character then return end;local al=a:GetPlayerFromCharacter(X)local am=al~=nil;if am and N then return end;if not am and O then return end;if not W(X)then return end;local a5=_(a0)if not a5 then return end;if t[a5]then return end;ab(a5,X,a0)if getgenv().AutoParry_OnAnimationSeen then getgenv().AutoParry_OnAnimationSeen(a5,a0,X)end end)P[aj]=ak end;local function an()for aj,ak in pairs(P)do if ak then ak:Disconnect()end end;P={}end;local function ao()for ap,aq in ipairs(b:GetDescendants())do if aq:IsA("Humanoid")then ai(aq)end end end;b.DescendantAdded:Connect(function(ar)if ar:IsA("Humanoid")then task.delay(0.05,function()if ar.Parent then ai(ar)end end)end end)ao()local as=nil;local function at()if not f then return end;local au=f.Character or f.CharacterAdded:Wait()local aj=au:FindFirstChildOfClass("Humanoid")or au:WaitForChild("Humanoid",5)if not aj then return end;as=aj.Health;aj.HealthChanged:Connect(function(av)if as and av<as then local aw=as-av;if v and v._timeline then v._timeline:AddEvent({type="damage",label=string.format("-%d HP",aw),info=string.format("HP: %.0f",av),sourceName="Self",time=os.clock()})end end;as=av end)end;if f then f.CharacterAdded:Connect(function()task.delay(0.1,at)end)at()end;v=h.CreateWindow({Title="AutoParry Config Builder",Size=Vector2.new(900,520),IconImageId="rbxassetid://136497541793809"})local ax=v:AddTab("Timeline")local ay=ax:AddSection("Controls")ay:AddLabel("Live timeline of animations / parries / damage in range.",28)local az=ax:AddSlider("Time Span (seconds)",5,60,10,function(aA)if v._timeline then v._timeline:SetSpan(aA)end end)local aB=ax:AddToggle("Pause timeline",false,function(aA)if v._timeline then v._timeline:SetPaused(aA)end end)ax:AddToggle("Show Animations",true,function(aA)if v._timeline then v._timeline:SetFilter("anim",aA)end end)ax:AddToggle("Show Config Hits",true,function(aA)if v._timeline then v._timeline:SetFilter("config",aA)end end)ax:AddToggle("Show Parries",true,function(aA)if v._timeline then v._timeline:SetFilter("parry",aA)end end)ax:AddToggle("Show Schedules",true,function(aA)if v._timeline then v._timeline:SetFilter("schedule",aA)end end)ax:AddToggle("Show Damage Taken",true,function(aA)if v._timeline then v._timeline:SetFilter("damage",aA)end end)local aC=ax:AddTimeline(220)v._timeline=aC;aC:SetSpan(10)if aC.SetIgnorePredicate then aC:SetIgnorePredicate(function(aD)local a2=aD.animId;return a2 and t[a2]==true end)end;local aE=Instance.new("ScreenGui")aE.Name="AP_PopupGui"aE.ResetOnSpawn=false;aE.IgnoreGuiInset=true;aE.ZIndexBehavior=Enum.ZIndexBehavior.Global;local aF=v._gui.DisplayOrder or 100;aE.DisplayOrder=aF+1;aE.Parent=v._gui.Parent or game:GetService("CoreGui")local aG=getgenv and getgenv()or{}if typeof(aG.protectgui)=="function"then pcall(aG.protectgui,aE)end;local aH=Instance.new("TextButton")aH.BackgroundColor3=Color3.fromRGB(0,0,0)aH.BackgroundTransparency=0.4;aH.BorderSizePixel=0;aH.Size=UDim2.new(1,0,1,0)aH.Text=""aH.Visible=false;aH.ZIndex=500000;aH.Parent=aE;local aI=Instance.new("Frame")aI.Size=UDim2.fromOffset(420,320)aI.Position=UDim2.new(0.5,-210,0.5,-160)aI.BackgroundColor3=Color3.fromRGB(18,22,22)aI.BorderColor3=Color3.fromRGB(60,80,80)aI.Visible=false;aI.ZIndex=500001;aI.Parent=aH;local aJ=Instance.new("UICorner")aJ.CornerRadius=UDim.new(0,8)aJ.Parent=aI;local aK=Instance.new("TextLabel")aK.BackgroundTransparency=1;aK.Size=UDim2.new(1,-10,0,22)aK.Position=UDim2.fromOffset(6,4)aK.Text="Animation"aK.Font=Enum.Font.Code;aK.TextSize=16;aK.TextXAlignment=Enum.TextXAlignment.Left;aK.TextColor3=Color3.fromRGB(230,240,235)aK.ZIndex=500002;aK.Parent=aI;local aL=Instance.new("ScrollingFrame")aL.BackgroundTransparency=1;aL.Size=UDim2.new(1,-12,1,-30)aL.Position=UDim2.fromOffset(6,26)aL.CanvasSize=UDim2.new(0,0,0,0)aL.AutomaticCanvasSize=Enum.AutomaticSize.Y;aL.ScrollBarThickness=4;aL.ZIndex=500002;aL.Parent=aI;local aM=Instance.new("UIListLayout")aM.FillDirection=Enum.FillDirection.Vertical;aM.SortOrder=Enum.SortOrder.LayoutOrder;aM.Padding=UDim.new(0,4)aM.Parent=aL;local function aN()for ap,aO in ipairs(aL:GetChildren())do if aO:IsA("GuiObject")then aO:Destroy()end end end;local function aP(aQ,aR)local aS=Instance.new("TextLabel")aS.BackgroundTransparency=1;aS.Size=UDim2.new(1,0,0,aR or 18)aS.Text=aQ;aS.Font=Enum.Font.Code;aS.TextSize=14;aS.TextXAlignment=Enum.TextXAlignment.Left;aS.TextColor3=Color3.fromRGB(200,210,210)aS.ZIndex=500003;aS.Parent=aL;return aS end;local function aT(aU,aV,aW)aP(aU)local aX=Instance.new("TextBox")aX.BackgroundColor3=Color3.fromRGB(26,30,30)aX.BorderColor3=Color3.fromRGB(70,90,90)aX.Size=UDim2.new(1,0,0,22)aX.Text=aV or""aX.Font=Enum.Font.Code;aX.TextSize=14;aX.TextXAlignment=Enum.TextXAlignment.Left;aX.TextColor3=Color3.fromRGB(230,240,235)aX.ZIndex=500003;aX.Parent=aL;aX.FocusLost:Connect(function()if aW then aW(aX.Text)end end)return aX end;local function aY(aQ,aW)local aZ=Instance.new("TextButton")aZ.BackgroundColor3=Color3.fromRGB(30,38,38)aZ.BorderColor3=Color3.fromRGB(70,90,90)aZ.Size=UDim2.new(1,0,0,24)aZ.Text=aQ;aZ.Font=Enum.Font.Code;aZ.TextSize=14;aZ.TextColor3=Color3.fromRGB(230,240,235)aZ.ZIndex=500003;aZ.Parent=aL;aZ.MouseButton1Click:Connect(function()if aW then aW()end end)return aZ end;aH.MouseButton1Click:Connect(function()local a_=e:GetMouseLocation()local b0,b1=aI.AbsolutePosition,aI.AbsoluteSize;local b2=a_.X>=b0.X and a_.X<=b0.X+b1.X and a_.Y>=b0.Y and a_.Y<=b0.Y+b1.Y;if b2 then return end;aH.Visible=false;aI.Visible=false;if v and v._timeline and v._timeline.HideTooltip then v._timeline:HideTooltip()end end)aI.InputBegan:Connect(function(b3)if b3.UserInputType==Enum.UserInputType.MouseButton1 then end end)local b4;local b5;local function b6(a5,b7)aN()local b8=q[a5]local b9=s[a5]local a7=b7 or b8 and b8.name or b9 and b9.name or a4(a5)local ba=a7 or"Anim "..tostring(a5)local bb=t[a5]==true;aK.Text=ba;aP("Anim ID: "..tostring(a5))local bc;bc=aY("Copy Animation ID",function()local bd=tostring(a5)local be=false;if setclipboard then setclipboard(bd)be=true elseif toclipboard then toclipboard(bd)be=true end;if be and bc then local bf=bc.Text;bc.Text="Copied!"task.delay(0.7,function()if bc and bc.Parent then bc.Text=bf end end)end end)if b9 then aP(string.format("Seen: %d times, last source: %s",b9.count or 0,b9.lastSourceName or"?"))else aP("Seen: (no data yet)")end;aP(bb and"Status: IGNORED (will not be tracked)"or"Status: active")if not b8 then aP("This animation is not in the config yet.",18)aY("Add to config (with defaults)",function()q[a5]={name=ba,startSec=tonumber(r.defaultStartSec)or 0.00,hold=tonumber(r.defaultHoldSec)or 0.35,rollOnFail=r.defaultRollOnFail==true,distanceAdj=0}J()if b4 then b4()end;if b5 then b5()end;if v._timeline then v._timeline:Redraw()end;b6(a5,ba)end)else aP("Config entry (live edit):",18)aT("Name",b8.name or ba,function(aQ)b8.name=aQ~=""and aQ or ba;J()if b5 then b5()end end)aT("Start (seconds)",tostring(b8.startSec or 0),function(aQ)local aA=tonumber(aQ)if aA then b8.startSec=aA;J()end end)aT("Hold (seconds)",tostring(b8.hold or 0.35),function(aQ)local aA=tonumber(aQ)if aA then b8.hold=aA;J()end end)aT("Dist Adj (s/100st)",tostring(b8.distanceAdj or 0),function(aQ)local aA=tonumber(aQ)if aA then b8.distanceAdj=aA;J()end end)aP("Roll on fail (true/false)")local bg=Instance.new("TextBox")bg.BackgroundColor3=Color3.fromRGB(26,30,30)bg.BorderColor3=Color3.fromRGB(70,90,90)bg.Size=UDim2.new(1,0,0,22)local function bh()return tostring(b8.rollOnFail and true or false)end;bg.Text=bh()bg.Font=Enum.Font.Code;bg.TextSize=14;bg.TextXAlignment=Enum.TextXAlignment.Left;bg.TextColor3=Color3.fromRGB(230,240,235)bg.ZIndex=500003;bg.Parent=aL;bg.FocusLost:Connect(function()local bi=string.lower(tostring(bg.Text))if bi=="true"or bi=="1"or bi=="yes"then b8.rollOnFail=true;J()bg.Text="true"elseif bi=="false"or bi=="0"or bi=="no"then b8.rollOnFail=false;J()bg.Text="false"else bg.Text=bh()end end)aY("Remove from config",function()q[a5]=nil;J()if b4 then b4()end;if b5 then b5()end;if v._timeline then v._timeline:Redraw()end;aH.Visible=false;aI.Visible=false end)end;aY(bb and"Unignore this animation"or"Ignore this animation",function()if t[a5]then t[a5]=nil else t[a5]=true end;J()if b4 then b4()end;if b5 then b5()end;if v and v._timeline then v._timeline:Redraw()end;aH.Visible=false;aI.Visible=false end)aH.Visible=true;aI.Visible=true end;aC.OnEventClicked=function(aD)if v and v._timeline and v._timeline.HideTooltip then v._timeline:HideTooltip()end;if aD.animId then b6(aD.animId,aD.animName)end end;local bj=v:AddTab("Live Anims")local bk=bj:AddSection("Listening")bk:AddLabel("Listens for animations around you and lets you add/edit config entries quickly.",30)local bl=bj:AddToggle("Listening",true,function(aA)K=aA end)local bm=bj:AddSlider("Listening Range (studs)",5,100,L,function(aA)L=aA end)local bn=bj:AddToggle("Ignore player animations",false,function(aA)N=aA end)local bo=bj:AddToggle("Ignore enemy/NPC animations",false,function(aA)O=aA end)local bp=bj:AddList(260)function b4()bp:Clear()local bq={}for a5,H in pairs(s)do table.insert(bq,{id=a5,lastTime=H.lastSeenTime or 0,count=H.count or 0,name=H.name})end;table.sort(bq,function(R,S)return R.lastTime>S.lastTime end)for ap,br in ipairs(bq)do local bs=q[br.id]~=nil;local bt=br.name or q[br.id]and q[br.id].name or"Anim "..br.id;local bu=string.format("[%s] %s  | ID %s  | seen %d",bs and"CFG"or"NEW",bt,br.id,br.count)bp:AddItem(bu,function()b6(br.id,bt)end)end end;local bv=v:AddTab("Config Anims")local bw=bv:AddSection("Config View")bw:AddLabel("Animations loaded from AP_Config.json. Click to edit them.",30)local bx="numeric"local by={}local bz;local function bA()if not bz then return end;bz:Clear()local bq={}for a5,b8 in pairs(q)do table.insert(bq,{id=a5,name=b8.name or"Anim "..a5,lastSeen=s[a5]and s[a5].lastSeenTime or 0})end;if bx=="numeric"then table.sort(bq,function(R,S)return(tonumber(R.id)or 0)<(tonumber(S.id)or 0)end)elseif bx=="alpha"then table.sort(bq,function(R,S)return tostring(R.name):lower()<tostring(S.name):lower()end)elseif bx=="recent"then table.sort(bq,function(R,S)return R.lastSeen>S.lastSeen end)end;for ap,br in ipairs(bq)do local bu=string.format("%s  |  ID: %s",br.name,br.id)bz:AddItem(bu,function()b6(br.id)end)end end;function b5()bA()end;local function bB()for bC,aZ in pairs(by)do if aZ and aZ:IsA("TextButton")then if bC==bx then aZ.BackgroundColor3=Color3.fromRGB(0,180,120)aZ.TextColor3=Color3.fromRGB(255,255,255)aZ.TextStrokeTransparency=0.75 else aZ.BackgroundColor3=Color3.fromRGB(18,24,24)aZ.TextColor3=Color3.fromRGB(200,210,220)aZ.TextStrokeTransparency=1 end end end end;by.numeric=bv:AddButton("Sort: Numeric (by ID)",function()bx="numeric"bB()bA()end)by.alpha=bv:AddButton("Sort: Alphabetical (by name)",function()bx="alpha"bB()bA()end)by.recent=bv:AddButton("Sort: Most recently detected",function()bx="recent"bB()bA()end)bB()bz=bv:AddList(260)local bD=v:AddTab("Utilities")local bE=bD:AddSection("Utilities")bE:AddLabel("Misc tools to help build configs and debug AutoParry.",32)local bF=bD:AddToggle("Save all animations to log file",false,function(aA)M=aA end)bD:AddButton("Scan all humanoids again (re-hook)",function()an()ao()end)bD:AddButton("Write full animation snapshot to file",function()local bG={}for a5,H in pairs(s)do table.insert(bG,{id=a5,count=H.count,lastSeenTime=H.lastSeenTime,lastSourceName=H.lastSourceName,inConfig=q[a5]~=nil,ignored=t[a5]==true})end;F(m,bG)end)bD:AddButton("Refresh configs from disk",function()I()bA()end)bD:AddButton("Force-save configs to disk",function()J()end)bD:AddButton("Reload timeline + lists now",function()if v._timeline then v._timeline:Redraw()end;b4()bA()end)bD:AddButton("Clear ignore list",function()t={}J()end)local bH=bD:AddSection("Default Config Add Settings")bH:AddLabel("Defaults used when you click 'Add to config'.",32)bD:AddSlider("Default start (ms)",0,2000,math.floor((r.defaultStartSec or 0)*1000+0.5),function(aA)r.defaultStartSec=(aA or 0)/1000;J()end)bD:AddSlider("Default hold (ms)",0,2000,math.floor((r.defaultHoldSec or 0.35)*1000+0.5),function(aA)r.defaultHoldSec=(aA or 0)/1000;J()end)bD:AddToggle("Default roll on fail",r.defaultRollOnFail==true,function(aA)r.defaultRollOnFail=aA and true or false;J()end)getgenv().AutoParry_OnAnimationSeen=function(a5,a0,X)if t[a5]then return end;local bs=q[a5]~=nil;local ae=a4(a5,a0)if v and v._timeline then v._timeline:AddEvent({type=bs and"config"or"anim",label=ae,animId=a5,animName=ae,sourceName=X and X.Name or"",inConfig=bs,time=os.clock()})end;b4()bA()end;getgenv().AutoParry_OnParryScheduled=function(a5,b8,bI,bJ,bK)local ae=b8 and b8.name or"Anim "..tostring(a5)local bL=bK or os.clock()if v and v._timeline then v._timeline:AddEvent({type="schedule",label=ae,animId=a5,animName=ae,sourceName=bI or"",info=string.format("press in %.1f ms",(bJ or 0)*1000),time=bL})end end;getgenv().AutoParry_OnParryFired=function(a5,b8,bI,bM)local ae=b8 and b8.name or"Anim "..tostring(a5)if v and v._timeline then v._timeline:AddEvent({type="parry",label=ae,animId=a5,animName=ae,sourceName=bI or"",chainId=bM,time=os.clock()})end end;getgenv().AutoParry_OnParryFailRoll=function(a5,b8,bI,bM)local ae=b8 and b8.name or"Anim "..tostring(a5)if v and v._timeline then v._timeline:AddEvent({type="parry",label=ae,animId=a5,animName=ae,sourceName=(bI or"").." (fail â†’ roll)",chainId=bM,time=os.clock()})end end;b4()bA()if v._timeline then v._timeline:Redraw()end;return{Window=v,GetConfig=function()return q end,GetConfigExtra=function()return r end,GameDir=i}end
