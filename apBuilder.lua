local a=game:GetService("Players")local b=game:GetService("Workspace")local c=game:GetService("HttpService")local d=game:GetService("MarketplaceService")local e=game:GetService("UserInputService")local f=a.LocalPlayer;return function(g)g=g or{}local h=loadstring(game:HttpGet("https://raw.githubusercontent.com/whodunitwww/noxhelpers/refs/heads/main/apUi.lua"))()local i=g.GameDir or"Cerberus/Universal"local j=i.."/AP_Config.json"local k=i.."/AP_Config_Extra.json"local l=i.."/AP_AnimLog.json"local m=i.."/AP_AllAnims.json"local n=i.."/AP_IgnoreAnims.json"local o=g.DefaultConfig or{["17030773401"]={name="Zombie Attack",startSec=0.42,hold=0.30,rollOnFail=true},["9876543210"]={name="Lunge",startSec=0.41,hold=0.30,rollOnFail=false}}local p=g.DefaultExtra or{parryKey="F",rollKey="Q"}local q={}local r={}local s={}local t={}local u={}local v;local function w(x)local y=string.match(x,"^(.*)/[^/]+$")if y and makefolder then pcall(makefolder,y)end end;local function z(x,A)if not isfile or not isfile(x)then return table.clone(A)end;local B,C=pcall(readfile,x)if not B or type(C)~="string"or C==""then return table.clone(A)end;local D,E=pcall(function()return c:JSONDecode(C)end)if not D or type(E)~="table"then return table.clone(A)end;return E end;local function F(x,G)if not writefile then return end;w(x)local B,H=pcall(function()return c:JSONEncode(G)end)if B then pcall(writefile,x,H)end end;local function I()q=z(j,o)r=z(k,p)t=z(n,{})end;local function J()F(j,q)F(k,r)F(n,t)end;if not(isfile and isfile(j))then I()J()else I()end;local K=true;local L=40;local M=false;local N=false;local O=false;local P={}local function Q(R,S)local T,U,V=R.X-S.X,R.Y-S.Y,R.Z-S.Z;return T*T+U*U+V*V end;local function W(X)if not f or not f.Character then return false end;local Y=X:FindFirstChild("HumanoidRootPart")or X.PrimaryPart;local Z=f.Character:FindFirstChild("HumanoidRootPart")if not(Y and Z)then return false end;return Q(Y.Position,Z.Position)<=L*L end;local function _(a0)local a1=a0.Animation and a0.Animation.AnimationId or""local a2=tostring(a1):match("%d+")return a2 end;local a3={}local function a4(a5,a0)a5=tostring(a5 or"")local a6=a3[a5]if a6 and a6~=""then return a6 end;local a7;if a0 then local a8=a0.Animation;if a8 and a8.Name and a8.Name~=""and a8.Name~="Animation"then a7=a8.Name elseif a0.Name and a0.Name~=""and a0.Name~="Animation"and a0.Name~="AnimationTrack"then a7=a0.Name end end;if not a7 and q[a5]and q[a5].name and q[a5].name~=""then a7=q[a5].name end;if not a7 then local a9=tonumber(a5)if a9 then local B,aa=pcall(function()return d:GetProductInfo(a9,Enum.InfoType.Asset)end)if B and aa and type(aa)=="table"and aa.Name and aa.Name~=""then a7=aa.Name end end end;if not a7 or a7==""then a7="Anim "..a5 end;a3[a5]=a7;return a7 end;local function ab(a5,ac,a0)local ad=os.clock()local ae=a4(a5,a0)local af=s[a5]if not af then af={id=a5,count=0,lastSeenTime=ad,lastSourceName=ac and ac.Name or"",name=ae}s[a5]=af end;af.count=(af.count or 0)+1;af.lastSeenTime=ad;af.lastSourceName=ac and ac.Name or af.lastSourceName;af.name=ae;if M and writefile then local ag={}if isfile and isfile(l)then local B,H=pcall(readfile,l)if B and H and H~=""then local D,ah=pcall(c.JSONDecode,c,H)if D and type(ah)=="table"then ag=ah end end end;table.insert(ag,{id=a5,name=ae,src=ac and ac:GetFullName()or"",t=ad})F(l,ag)end end;local function ai(aj)if P[aj]then return end;local ak;ak=aj.AnimationPlayed:Connect(function(a0)if not K then return end;local X=aj.Parent;if not X or not X:IsDescendantOf(b)then return end;if f and X==f.Character then return end;local al=a:GetPlayerFromCharacter(X)local am=al~=nil;if am and N then return end;if not am and O then return end;if not W(X)then return end;local a5=_(a0)if not a5 then return end;if t[a5]then return end;ab(a5,X,a0)if getgenv().AutoParry_OnAnimationSeen then getgenv().AutoParry_OnAnimationSeen(a5,a0,X)end end)P[aj]=ak end;local function an()for aj,ak in pairs(P)do if ak then ak:Disconnect()end end;P={}end;local function ao()for ap,aq in ipairs(b:GetDescendants())do if aq:IsA("Humanoid")then ai(aq)end end end;b.DescendantAdded:Connect(function(ar)if ar:IsA("Humanoid")then task.delay(0.05,function()if ar.Parent then ai(ar)end end)end end)ao()local as=nil;local function at()if not f then return end;local au=f.Character or f.CharacterAdded:Wait()local aj=au:FindFirstChildOfClass("Humanoid")or au:WaitForChild("Humanoid",5)if not aj then return end;as=aj.Health;aj.HealthChanged:Connect(function(av)if as and av<as then local aw=as-av;if v and v._timeline then v._timeline:AddEvent({type="damage",label=string.format("-%d HP",aw),info=string.format("HP: %.0f",av),sourceName="Self",time=os.clock()})end end;as=av end)end;if f then f.CharacterAdded:Connect(function()task.delay(0.1,at)end)at()end;v=h.CreateWindow({Title="AutoParry Config Builder",Size=Vector2.new(900,520),IconImageId="rbxassetid://136497541793809"})local ax=v:AddTab("Timeline")local ay=ax:AddSection("Controls")ay:AddLabel("Live timeline of animations / parries / damage in range.",28)local az=ax:AddSlider("Time Span (seconds)",5,60,10,function(aA)if v._timeline then v._timeline:SetSpan(aA)end end)local aB=ax:AddToggle("Pause timeline",false,function(aA)if v._timeline then v._timeline:SetPaused(aA)end end)ax:AddToggle("Show Animations",true,function(aA)if v._timeline then v._timeline:SetFilter("anim",aA)end end)ax:AddToggle("Show Config Hits",true,function(aA)if v._timeline then v._timeline:SetFilter("config",aA)end end)ax:AddToggle("Show Parries",true,function(aA)if v._timeline then v._timeline:SetFilter("parry",aA)end end)ax:AddToggle("Show Schedules",true,function(aA)if v._timeline then v._timeline:SetFilter("schedule",aA)end end)ax:AddToggle("Show Damage Taken",true,function(aA)if v._timeline then v._timeline:SetFilter("damage",aA)end end)local aC=ax:AddTimeline(220)v._timeline=aC;aC:SetSpan(10)if aC.SetIgnorePredicate then aC:SetIgnorePredicate(function(aD)local a2=aD.animId;return a2 and t[a2]==true end)end;local aE=Instance.new("ScreenGui")aE.Name="AP_PopupGui"aE.ResetOnSpawn=false;aE.IgnoreGuiInset=true;aE.ZIndexBehavior=Enum.ZIndexBehavior.Global;local aF=v._gui.DisplayOrder or 100;aE.DisplayOrder=aF+1;aE.Parent=v._gui.Parent or game:GetService("CoreGui")local aG=getgenv and getgenv()or{}if typeof(aG.protectgui)=="function"then pcall(aG.protectgui,aE)end;local aH=Instance.new("TextButton")aH.BackgroundColor3=Color3.fromRGB(0,0,0)aH.BackgroundTransparency=0.4;aH.BorderSizePixel=0;aH.Size=UDim2.new(1,0,1,0)aH.Text=""aH.Visible=false;aH.ZIndex=500000;aH.Parent=aE;local aI=Instance.new("Frame")aI.Size=UDim2.fromOffset(420,320)aI.Position=UDim2.new(0.5,-210,0.5,-160)aI.BackgroundColor3=Color3.fromRGB(18,22,22)aI.BorderColor3=Color3.fromRGB(60,80,80)aI.Visible=false;aI.ZIndex=500001;aI.Parent=aH;local aJ=Instance.new("UICorner")aJ.CornerRadius=UDim.new(0,8)aJ.Parent=aI;local aK=Instance.new("TextLabel")aK.BackgroundTransparency=1;aK.Size=UDim2.new(1,-10,0,22)aK.Position=UDim2.fromOffset(6,4)aK.Text="Animation"aK.Font=Enum.Font.Code;aK.TextSize=16;aK.TextXAlignment=Enum.TextXAlignment.Left;aK.TextColor3=Color3.fromRGB(230,240,235)aK.ZIndex=500002;aK.Parent=aI;local aL=Instance.new("ScrollingFrame")aL.BackgroundTransparency=1;aL.Size=UDim2.new(1,-12,1,-30)aL.Position=UDim2.fromOffset(6,26)aL.CanvasSize=UDim2.new(0,0,0,0)aL.AutomaticCanvasSize=Enum.AutomaticSize.Y;aL.ScrollBarThickness=4;aL.ZIndex=500002;aL.Parent=aI;local aM=Instance.new("UIListLayout")aM.FillDirection=Enum.FillDirection.Vertical;aM.SortOrder=Enum.SortOrder.LayoutOrder;aM.Padding=UDim.new(0,4)aM.Parent=aL;local function aN()for ap,aO in ipairs(aL:GetChildren())do if aO:IsA("GuiObject")then aO:Destroy()end end end;local function aP(aQ,aR)local aS=Instance.new("TextLabel")aS.BackgroundTransparency=1;aS.Size=UDim2.new(1,0,0,aR or 18)aS.Text=aQ;aS.Font=Enum.Font.Code;aS.TextSize=14;aS.TextXAlignment=Enum.TextXAlignment.Left;aS.TextColor3=Color3.fromRGB(200,210,210)aS.ZIndex=500003;aS.Parent=aL;return aS end;local function aT(aU,aV,aW)aP(aU)local aX=Instance.new("TextBox")aX.BackgroundColor3=Color3.fromRGB(26,30,30)aX.BorderColor3=Color3.fromRGB(70,90,90)aX.Size=UDim2.new(1,0,0,22)aX.Text=aV or""aX.Font=Enum.Font.Code;aX.TextSize=14;aX.TextXAlignment=Enum.TextXAlignment.Left;aX.TextColor3=Color3.fromRGB(230,240,235)aX.ZIndex=500003;aX.Parent=aL;aX.FocusLost:Connect(function(aY)if aY and aW then aW(aX.Text)end end)return aX end;local function aZ(aQ,aW)local a_=Instance.new("TextButton")a_.BackgroundColor3=Color3.fromRGB(30,38,38)a_.BorderColor3=Color3.fromRGB(70,90,90)a_.Size=UDim2.new(1,0,0,24)a_.Text=aQ;a_.Font=Enum.Font.Code;a_.TextSize=14;a_.TextColor3=Color3.fromRGB(230,240,235)a_.ZIndex=500003;a_.Parent=aL;a_.MouseButton1Click:Connect(function()if aW then aW()end end)return a_ end;aH.MouseButton1Click:Connect(function()local b0=e:GetMouseLocation()local b1,b2=aI.AbsolutePosition,aI.AbsoluteSize;local b3=b0.X>=b1.X and b0.X<=b1.X+b2.X and b0.Y>=b1.Y and b0.Y<=b1.Y+b2.Y;if b3 then return end;aH.Visible=false;aI.Visible=false;if v and v._timeline and v._timeline.HideTooltip then v._timeline:HideTooltip()end end)aI.InputBegan:Connect(function(b4)if b4.UserInputType==Enum.UserInputType.MouseButton1 then end end)local b5;local b6;local function b7(a5,b8)aN()local b9=q[a5]local ba=s[a5]local a7=b8 or b9 and b9.name or ba and ba.name or a4(a5)local bb=a7 or"Anim "..tostring(a5)local bc=t[a5]==true;aK.Text=bb;aP("Anim ID: "..tostring(a5))local bd;bd=aZ("Copy Animation ID",function()local be=tostring(a5)local bf=false;if setclipboard then setclipboard(be)bf=true elseif toclipboard then toclipboard(be)bf=true end;if bf and bd then local bg=bd.Text;bd.Text="Copied!"task.delay(0.7,function()if bd and bd.Parent then bd.Text=bg end end)end end)if ba then aP(string.format("Seen: %d times, last source: %s",ba.count or 0,ba.lastSourceName or"?"))else aP("Seen: (no data yet)")end;aP(bc and"Status: IGNORED (will not be tracked)"or"Status: active")if not b9 then aP("This animation is not in the config yet.",18)aZ("Add to config (with defaults)",function()q[a5]={name=bb,startSec=tonumber(r.defaultStartSec)or 0.00,hold=tonumber(r.defaultHoldSec)or 0.35,rollOnFail=r.defaultRollOnFail==true}J()if b5 then b5()end;if b6 then b6()end;if v._timeline then v._timeline:Redraw()end;b7(a5,bb)end)else aP("Config entry (live edit):",18)aT("Name",b9.name or bb,function(aQ)b9.name=aQ~=""and aQ or bb;J()if b6 then b6()end end)aT("Start (seconds)",tostring(b9.startSec or 0),function(aQ)local aA=tonumber(aQ)if aA then b9.startSec=aA;J()end end)aT("Hold (seconds)",tostring(b9.hold or 0.35),function(aQ)local aA=tonumber(aQ)if aA then b9.hold=aA;J()end end)aP("Roll on fail (true/false)")local bh=Instance.new("TextBox")bh.BackgroundColor3=Color3.fromRGB(26,30,30)bh.BorderColor3=Color3.fromRGB(70,90,90)bh.Size=UDim2.new(1,0,0,22)local function bi()return tostring(b9.rollOnFail and true or false)end;bh.Text=bi()bh.Font=Enum.Font.Code;bh.TextSize=14;bh.TextXAlignment=Enum.TextXAlignment.Left;bh.TextColor3=Color3.fromRGB(230,240,235)bh.ZIndex=52;bh.Parent=aL;bh.FocusLost:Connect(function(aY)if not aY then bh.Text=bi()return end;local bj=string.lower(tostring(bh.Text))if bj=="true"or bj=="1"or bj=="yes"then b9.rollOnFail=true;J()bh.Text="true"elseif bj=="false"or bj=="0"or bj=="no"then b9.rollOnFail=false;J()bh.Text="false"else bh.Text=bi()end end)aZ("Remove from config",function()q[a5]=nil;J()if b5 then b5()end;if b6 then b6()end;if v._timeline then v._timeline:Redraw()end;aH.Visible=false;aI.Visible=false end)end;aZ(bc and"Unignore this animation"or"Ignore this animation",function()if t[a5]then t[a5]=nil else t[a5]=true end;J()if b5 then b5()end;if b6 then b6()end;if v and v._timeline then v._timeline:Redraw()end;aH.Visible=false;aI.Visible=false end)aH.Visible=true;aI.Visible=true end;aC.OnEventClicked=function(aD)if v and v._timeline and v._timeline.HideTooltip then v._timeline:HideTooltip()end;if aD.animId then b7(aD.animId,aD.animName)end end;local bk=v:AddTab("Live Anims")local bl=bk:AddSection("Listening")bl:AddLabel("Listens for animations around you and lets you add/edit config entries quickly.",30)local bm=bk:AddToggle("Listening",true,function(aA)K=aA end)local bn=bk:AddSlider("Listening Range (studs)",5,100,L,function(aA)L=aA end)local bo=bk:AddToggle("Ignore player animations",false,function(aA)N=aA end)local bp=bk:AddToggle("Ignore enemy/NPC animations",false,function(aA)O=aA end)local bq=bk:AddList(260)function b5()bq:Clear()local br={}for a5,H in pairs(s)do table.insert(br,{id=a5,lastTime=H.lastSeenTime or 0,count=H.count or 0,name=H.name})end;table.sort(br,function(R,S)return R.lastTime>S.lastTime end)for ap,bs in ipairs(br)do local bt=q[bs.id]~=nil;local bu=bs.name or q[bs.id]and q[bs.id].name or"Anim "..bs.id;local bv=string.format("[%s] %s  | ID %s  | seen %d",bt and"CFG"or"NEW",bu,bs.id,bs.count)bq:AddItem(bv,function()b7(bs.id,bu)end)end end;local bw=v:AddTab("Config Anims")local bx=bw:AddSection("Config View")bx:AddLabel("Animations loaded from AP_Config.json. Click to edit them.",30)local by="numeric"local bz={}local bA;local function bB()if not bA then return end;bA:Clear()local br={}for a5,b9 in pairs(q)do table.insert(br,{id=a5,name=b9.name or"Anim "..a5,lastSeen=s[a5]and s[a5].lastSeenTime or 0})end;if by=="numeric"then table.sort(br,function(R,S)return(tonumber(R.id)or 0)<(tonumber(S.id)or 0)end)elseif by=="alpha"then table.sort(br,function(R,S)return tostring(R.name):lower()<tostring(S.name):lower()end)elseif by=="recent"then table.sort(br,function(R,S)return R.lastSeen>S.lastSeen end)end;for ap,bs in ipairs(br)do local bv=string.format("%s  |  ID: %s",bs.name,bs.id)bA:AddItem(bv,function()b7(bs.id)end)end end;function b6()bB()end;local function bC()for bD,a_ in pairs(bz)do if a_ and a_:IsA("TextButton")then if bD==by then a_.BackgroundColor3=Color3.fromRGB(0,180,120)a_.TextColor3=Color3.fromRGB(255,255,255)a_.TextStrokeTransparency=0.75 else a_.BackgroundColor3=Color3.fromRGB(18,24,24)a_.TextColor3=Color3.fromRGB(200,210,220)a_.TextStrokeTransparency=1 end end end end;bz.numeric=bw:AddButton("Sort: Numeric (by ID)",function()by="numeric"bC()bB()end)bz.alpha=bw:AddButton("Sort: Alphabetical (by name)",function()by="alpha"bC()bB()end)bz.recent=bw:AddButton("Sort: Most recently detected",function()by="recent"bC()bB()end)bC()bA=bw:AddList(260)local bE=v:AddTab("Utilities")local bF=bE:AddSection("Utilities")bF:AddLabel("Misc tools to help build configs and debug AutoParry.",32)local bG=bE:AddToggle("Save all animations to log file",false,function(aA)M=aA end)bE:AddButton("Scan all humanoids again (re-hook)",function()an()ao()end)bE:AddButton("Write full animation snapshot to file",function()local bH={}for a5,H in pairs(s)do table.insert(bH,{id=a5,count=H.count,lastSeenTime=H.lastSeenTime,lastSourceName=H.lastSourceName,inConfig=q[a5]~=nil,ignored=t[a5]==true})end;F(m,bH)end)bE:AddButton("Refresh configs from disk",function()I()bB()end)bE:AddButton("Force-save configs to disk",function()J()end)bE:AddButton("Reload timeline + lists now",function()if v._timeline then v._timeline:Redraw()end;b5()bB()end)bE:AddButton("Clear ignore list",function()t={}J()end)local bI=bE:AddSection("Default Config Add Settings")bI:AddLabel("Defaults used when you click 'Add to config'.",32)bE:AddSlider("Default start (ms)",0,2000,math.floor((r.defaultStartSec or 0)*1000+0.5),function(aA)r.defaultStartSec=(aA or 0)/1000;J()end)bE:AddSlider("Default hold (ms)",0,2000,math.floor((r.defaultHoldSec or 0.35)*1000+0.5),function(aA)r.defaultHoldSec=(aA or 0)/1000;J()end)bE:AddToggle("Default roll on fail",r.defaultRollOnFail==true,function(aA)r.defaultRollOnFail=aA and true or false;J()end)getgenv().AutoParry_OnAnimationSeen=function(a5,a0,X)if t[a5]then return end;local bt=q[a5]~=nil;local ae=a4(a5,a0)if v and v._timeline then v._timeline:AddEvent({type=bt and"config"or"anim",label=ae,animId=a5,animName=ae,sourceName=X and X.Name or"",inConfig=bt,time=os.clock()})end;b5()bB()end;getgenv().AutoParry_OnParryScheduled=function(a5,b9,bJ,bK,bL)local ae=b9 and b9.name or"Anim "..tostring(a5)local bM=bL or os.clock()if v and v._timeline then v._timeline:AddEvent({type="schedule",label=ae,animId=a5,animName=ae,sourceName=bJ or"",info=string.format("press in %.1f ms",(bK or 0)*1000),time=bM})end end;getgenv().AutoParry_OnParryFired=function(a5,b9,bJ,bN)local ae=b9 and b9.name or"Anim "..tostring(a5)if v and v._timeline then v._timeline:AddEvent({type="parry",label=ae,animId=a5,animName=ae,sourceName=bJ or"",chainId=bN,time=os.clock()})end end;getgenv().AutoParry_OnParryFailRoll=function(a5,b9,bJ,bN)local ae=b9 and b9.name or"Anim "..tostring(a5)if v and v._timeline then v._timeline:AddEvent({type="parry",label=ae,animId=a5,animName=ae,sourceName=(bJ or"").." (fail â†’ roll)",chainId=bN,time=os.clock()})end end;b5()bB()if v._timeline then v._timeline:Redraw()end;return{Window=v,GetConfig=function()return q end,GetConfigExtra=function()return r end,GameDir=i}end
