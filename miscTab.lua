return function(a)local b=a.Services;local c=a.Tabs;local d=a.References;local e=a.Library;local f=a.Options;local g=a.Toggles;local h=a.LPH_NO_VIRTUALIZE or function(i)return i end;local j=c.Misc:AddRightGroupbox("Performance HUD","gauge")local k={gui=nil,conn=nil,fpsSmooth=60,scale=1}local function l()local m,n=pcall(function()return rawget(getfenv(),"gethui")and gethui()or b.CoreGui or game:GetService("CoreGui")end)return m and n or b.Players.LocalPlayer:WaitForChild("PlayerGui")end;local function o()if k.conn then k.conn:Disconnect()k.conn=nil end;if k.gui then k.gui:Destroy()k.gui=nil end end;local function p()o()local q=l()local r=Instance.new("ScreenGui")r.Name="CerberusHUD"r.ResetOnSpawn=false;r.IgnoreGuiInset=true;r.ZIndexBehavior=Enum.ZIndexBehavior.Sibling;r.Parent=q;k.gui=r;local s=Instance.new("Frame")s.Name="Holder"s.AnchorPoint=Vector2.new(1,0)s.Position=UDim2.new(1,-20,0,20)s.Size=UDim2.fromOffset(320,100)s.BackgroundColor3=Color3.fromRGB(29,30,36)s.BackgroundTransparency=0.05;s.Active=true;s.Parent=r;local t=Instance.new("UICorner",s)t.CornerRadius=UDim.new(0,18)local u=Instance.new("UIStroke",s)u.Thickness=2;u.Transparency=0.3;u.Color=Color3.fromRGB(92,94,104)local v=Instance.new("ImageLabel")v.Name="Shadow"v.BackgroundTransparency=1;v.Image="rbxassetid://5028857084"v.ImageTransparency=0.6;v.ScaleType=Enum.ScaleType.Slice;v.SliceCenter=Rect.new(24,24,276,276)v.Size=UDim2.new(1,24,1,24)v.Position=UDim2.new(0,-12,0,-12)v.ZIndex=0;v.Parent=s;local w=Instance.new("Frame")w.Name="Left"w.BackgroundTransparency=1;w.Size=UDim2.new(0.65,0,1,-20)w.Position=UDim2.new(0,20,0,10)w.Parent=s;local x=Instance.new("UIListLayout",w)x.FillDirection=Enum.FillDirection.Vertical;x.VerticalAlignment=Enum.VerticalAlignment.Center;x.Padding=UDim.new(0,12)local function y(z)local i=Instance.new("Frame")i.BackgroundTransparency=1;i.Size=UDim2.new(1,0,0,34)local A=Instance.new("TextLabel")A.Name="Title"A.BackgroundTransparency=1;A.Font=Enum.Font.Gotham;A.Text=z;A.TextColor3=Color3.fromRGB(172,175,185)A.TextSize=16;A.TextXAlignment=Enum.TextXAlignment.Left;A.Size=UDim2.new(0.5,0,1,0)A.Parent=i;local B=Instance.new("TextLabel")B.Name="Value"B.BackgroundTransparency=1;B.Font=Enum.Font.GothamSemibold;B.Text="--"B.TextColor3=Color3.fromRGB(238,239,244)B.TextSize=28;B.TextXAlignment=Enum.TextXAlignment.Left;B.Position=UDim2.new(0.5,0,0,0)B.Size=UDim2.new(0.5,0,1,0)B.Parent=i;return i,B end;local C,D=y("FPS")C.Parent=w;local E,F=y("Ping")E.Parent=w;local G=Instance.new("ImageLabel")G.Name="Icon"G.BackgroundTransparency=1;G.AnchorPoint=Vector2.new(1,0.5)G.Position=UDim2.new(1,-24,0.5,0)G.Size=UDim2.fromOffset(56,56)G.Image="rbxassetid://136497541793809"G.ImageColor3=Color3.fromRGB(55,235,120)G.Parent=s;local H,I,J;s.InputBegan:Connect(function(K)if K.UserInputType==Enum.UserInputType.MouseButton1 or K.UserInputType==Enum.UserInputType.Touch then H,I,J=true,K.Position,s.Position;K.Changed:Connect(function()if K.UserInputState==Enum.UserInputState.End then H=false end end)end end)s.InputChanged:Connect(function(K)if H and(K.UserInputType==Enum.UserInputType.MouseMovement or K.UserInputType==Enum.UserInputType.Touch)then local L=K.Position-I;s.Position=UDim2.new(J.X.Scale,J.X.Offset+L.X,J.Y.Scale,J.Y.Offset+L.Y)end end)local M=game:GetService("Stats")local N=M and M.Network and M.Network.ServerStatsItem and M.Network.ServerStatsItem["Data Ping"]k.conn=b.RunService.RenderStepped:Connect(h(function(O)local P=O>0 and 1/O or 60;k.fpsSmooth=k.fpsSmooth+(P-k.fpsSmooth)*0.2;D.Text=string.format("%d",math.clamp(math.floor(k.fpsSmooth+0.5),1,1000))local Q;if N and N.GetValue then local m,B=pcall(function()return N:GetValue()end)if m and type(B)=="number"then Q=math.floor(B+0.5)end end;if not Q and N and N.GetValueString then local m,R=pcall(function()return N:GetValueString()end)if m and type(R)=="string"then Q=tonumber(R:match("(%d+)"))end end;F.Text=Q and Q.." ms"or"--"end))end;j:AddToggle("HUD_Enable",{Text="Show FPS + Ping",Tooltip="Can only show up to 60 fps",Default=false,Callback=function(S)if S then p()else o()end end})j:AddSlider("HUD_Scale",{Text="HUD Scale",Default=90,Min=70,Max=150,Rounding=0,Suffix="%",Callback=function(B)k.scale=B/100;if k.gui and k.gui:FindFirstChild("Holder")then local s=k.gui.Holder;s.Size=UDim2.fromOffset(320*k.scale,100*k.scale)for T,U in ipairs(s:GetDescendants())do if U:IsA("TextLabel")then if U.Name=="Title"then U.TextSize=16*k.scale elseif U.Name=="Value"then U.TextSize=28*k.scale end end end end end})local V=c.Misc:AddLeftGroupbox("Server Panel","server")local function W(X)local Y=("https://games.roblox.com/v1/games/%d/servers/Public?sortOrder=Asc&limit=100%s"):format(game.PlaceId,X and"&cursor="..b.HttpService:UrlEncode(X)or"")local m,Z=pcall(function()return b.HttpService:JSONDecode(game:HttpGet(Y))end)return m and Z or nil end;V:AddButton({Text="Rejoin Server",Func=function()e:Notify("Rejoining server...",1)if game.PlaceId and game.JobId and d.player then b.TeleportService:TeleportToPlaceInstance(game.PlaceId,game.JobId,d.player)else e:Notify("Rejoin failed: missing ids",4)end end})V:AddButton({Text="Join Random Server",Func=function()e:Notify("Joining random server...",1)local X=nil;for T=1,5 do local Z=W(X)if not Z or not Z.data then break end;local _={}for T,a0 in ipairs(Z.data)do if a0.id~=game.JobId and a0.playing<a0.maxPlayers then table.insert(_,a0)end end;if#_>0 then local a1=_[math.random(1,#_)]return b.TeleportService:TeleportToPlaceInstance(game.PlaceId,a1.id,d.player)end;X=Z.nextPageCursor;if not X then break end end;e:Notify("Couldn't find an available server.",5)end})V:AddButton({Text="Join Lowest Server",Func=function()e:Notify("Joining lowest server...",1)local X,a2,a3=nil,nil,math.huge;for T=1,6 do local Z=W(X)if not Z or not Z.data then break end;for T,a0 in ipairs(Z.data)do if a0.id~=game.JobId and a0.playing<a0.maxPlayers and a0.playing<a3 then a2,a3=a0,a0.playing end end;X=Z.nextPageCursor;if not X then break end end;if a2 then b.TeleportService:TeleportToPlaceInstance(game.PlaceId,a2.id,d.player)else e:Notify("No suitable server with fewer players.",5)end end})V:AddButton({Text="Copy Join Script",Func=function()if setclipboard then pcall(setclipboard,("game:GetService('TeleportService'):TeleportToPlaceInstance(%d,%q,game.Players.LocalPlayer)\n"):format(game.PlaceId,game.JobId))e:Notify("Copied current-server join script.",4)else e:Notify("Clipboard not available.",4)end end})V:AddDivider()local a4={enabled=false,thread=nil}local function a5()a4.enabled=false;a4.thread=nil;if g.SERVER_AutoHop then pcall(function()g.SERVER_AutoHop:SetValue(false)end)end end;local function a6()if a4.thread then return end;a4.enabled=true;a4.thread=task.spawn(function()while a4.enabled and g.SERVER_AutoHop and g.SERVER_AutoHop.Value do local a7=math.max(1,f.SERVER_HopDelay and f.SERVER_HopDelay.Value or 60)local a8=0;while a8<a7 and a4.enabled and g.SERVER_AutoHop.Value do task.wait(1)a8=a8+1 end;if not(a4.enabled and g.SERVER_AutoHop.Value)then break end;local a9=math.max(0,math.floor(f.SERVER_MinPlayers and f.SERVER_MinPlayers.Value or 0))local X,a1=nil,nil;for T=1,6 do local Z=W(X)if not Z or not Z.data then break end;local _={}for T,a0 in ipairs(Z.data)do if a0.id~=game.JobId and a0.playing<a0.maxPlayers and a0.playing>=a9 then _[#_+1]=a0 end end;if#_>0 then a1=_[math.random(1,#_)]break end;X=Z.nextPageCursor;if not X then break end end;if a1 and game.PlaceId and d.player then e:Notify(("Auto-hop: joining %s (%d/%d)"):format(a1.id,a1.playing,a1.maxPlayers),3)b.TeleportService:TeleportToPlaceInstance(game.PlaceId,a1.id,d.player)else e:Notify("Auto-hop: no suitable server found; retrying after delay.",3)end end;a4.thread=nil end)end;local aa=V:AddToggle("SERVER_AutoHop",{Text="Auto Hop",Default=false})V:AddSlider("SERVER_HopDelay",{Text="Hop Delay (s)",Default=180,Min=5,Max=600,Rounding=0,Tooltip="Seconds to wait between hops"})V:AddSlider("SERVER_MinPlayers",{Text="Minimum Players",Default=3,Min=0,Max=20,Rounding=0,Tooltip="Only join servers with at least this many players"})aa:OnChanged(function()if not game.PlaceId or not d.player then e:Notify("Cannot auto-hop: missing PlaceId/LocalPlayer.",5)pcall(function()g.SERVER_AutoHop:SetValue(false)end)return end;if g.SERVER_AutoHop.Value then a6()else a5()end end)local ab=c.Misc:AddRightGroupbox("Environment","trees")local ac,ad=false,Color3.fromRGB(128,128,128)local ae=b.Lighting and b.Lighting.Ambient or Color3.new()local af,ag,ah=false,b.Lighting and b.Lighting.ClockTime or 12,nil;local function ai()if b.Lighting then b.Lighting.Ambient=ac and ad or ae end end;ab:AddToggle("ENV_Ambient",{Text="Custom Ambient",Default=false,Tooltip="Choose your own custom ambient color.",Callback=function(B)ac=B;ai()end})ab:AddLabel("Ambient Color"):AddColorPicker("ENV_AmbientColor",{Default=ad,Title="Ambient Color",Callback=function(aj)ad=aj;if ac then ai()end end})ab:AddToggle("ENV_TimeLock",{Text="Custom Time of Day",Default=false,Callback=function(S)af=S;if S then if b.Lighting then b.Lighting.ClockTime=ag end;if not ah then ah=b.RunService.RenderStepped:Connect(h(function()if b.Lighting then b.Lighting.ClockTime=ag end end))end;e:Notify("Time of Day locked.",3)else if ah then ah:Disconnect()ah=nil end;e:Notify("Time of Day unlocked.",3)end end})ab:AddSlider("ENV_Time",{Text="Time of Day",Default=ag,Min=0,Max=24,Rounding=2,Suffix="h",Callback=function(B)ag=B;if af and b.Lighting then b.Lighting.ClockTime=B end end})local function ak()if ah then ah:Disconnect()ah=nil end;if b.Lighting then b.Lighting.Ambient=ae end end;local al=c.Misc:AddLeftGroupbox("Spectate","view")local am,an;local ao=al:AddDropdown("SpectateTarget",{Values={},Default=nil,Multi=false,Text="Select Player"})al:AddButton({Text="Refresh Players",Func=function()local A={}for T,ap in ipairs(b.Players:GetPlayers())do if ap~=d.player then A[#A+1]=ap.Name end end;ao:SetValues(A)end})local aq=al:AddToggle("SpectateEnabled",{Text="Spectate Player",Default=false})local function ar()if am then am:Disconnect()am=nil end;an=nil;if d.humanoid then d.camera.CameraSubject=d.humanoid end end;local function as(at)ar()an=at;if not an then return end;am=b.RunService.RenderStepped:Connect(h(function()local au=an.Character;if au and au:FindFirstChild("Humanoid")then d.camera.CameraSubject=au:FindFirstChild("Humanoid")else ar()aq:SetValue(false)end end))end;aq:OnChanged(function()if aq.Value then local av=ao.Value;local at=av and b.Players:FindFirstChild(av)if at then as(at)else e:Notify("Select a player to spectate.",3)aq:SetValue(false)end else ar()end end)ao:OnChanged(function(av)if aq.Value then local at=av and b.Players:FindFirstChild(av)if at then as(at)end end end)b.Players.PlayerAdded:Connect(function()local A={}for T,ap in ipairs(b.Players:GetPlayers())do if ap~=d.player then A[#A+1]=ap.Name end end;ao:SetValues(A)end)b.Players.PlayerRemoving:Connect(function(aw)local A={}for T,ap in ipairs(b.Players:GetPlayers())do if ap~=d.player and ap~=aw then A[#A+1]=ap.Name end end;ao:SetValues(A)if an==aw then aq:SetValue(false)end end)do local A={}for T,ap in ipairs(b.Players:GetPlayers())do if ap~=d.player then A[#A+1]=ap.Name end end;ao:SetValues(A)end;local ax={}function ax.Unload()o()ak()ar()if g.SERVER_AutoHop and g.SERVER_AutoHop.Value then g.SERVER_AutoHop:SetValue(false)end;pcall(function()if a4 and a4.thread then a4.enabled=false end end)end;return ax end
